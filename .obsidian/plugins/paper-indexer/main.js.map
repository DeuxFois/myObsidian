{
  "version": 3,
  "sources": ["config/constants.js", "services/llm-service.js", "services/metadata-service.js", "utils/formatters.js", "services/file-service.js", "services/paper-service.js", "services/pdf-service.js", "ui/paper-explorer-view.js", "ui/chat-panel-view.js", "ui/paper-modal.js", "ui/settings-tab.js", "plugin.js"],
  "sourcesContent": ["const DEFAULT_SETTINGS = {\r\n    summaryApiEndpoint: '',\r\n    summaryApiModel: '',\r\n    summaryApiKey: '',\r\n    pdfDownloadFolder: '_research-papers',\r\n    hideFolderFromFiles: false,\r\n    sectors: ['Other'],\r\n    defaultSector: 'Other',\r\n    // Maximum number of PDF characters to include when generating a resume.\r\n    // Helps control token usage. 0 disables PDF text inclusion.\r\n    maxPdfCharactersForResume: 20000000,\r\n};\r\n\r\nmodule.exports = { DEFAULT_SETTINGS };", "const { requestUrl } = require('obsidian');\r\n\r\n/**\r\n * Service for handling LLM API interactions\r\n */\r\nclass LLMService {\r\n    constructor(settings) {\r\n        this.settings = settings;\r\n    }\r\n\r\n    /**\r\n     * Centralized LLM call wrapper\r\n     * @param {Object} requestBody - The request body for the API\r\n     * @returns {Promise<string>} The response content\r\n     */\r\n    async callLLM(requestBody) {\r\n        if (!this.settings.summaryApiEndpoint || !this.settings.summaryApiModel) {\r\n            throw new Error(\"API endpoint or model is not configured in settings.\");\r\n        }\r\n        if (!this.settings.summaryApiKey) {\r\n            throw new Error(\"API key is not configured in settings.\");\r\n        }\r\n\r\n        console.log('LLM API Call Debug:', {\r\n            endpoint: this.settings.summaryApiEndpoint,\r\n            model: this.settings.summaryApiModel,\r\n            keyPresent: !!this.settings.summaryApiKey,\r\n            keyPrefix: this.settings.summaryApiKey?.substring(0, 10) + '...'\r\n        });\r\n\r\n        try {\r\n            const res = await requestUrl({\r\n                url: this.settings.summaryApiEndpoint,\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${this.settings.summaryApiKey}`\r\n                },\r\n                body: JSON.stringify(requestBody)\r\n            });\r\n\r\n            console.log('LLM API Response Debug:', {\r\n                status: res.status,\r\n                headers: res.headers,\r\n                textLength: res.text?.length || 0\r\n            });\r\n\r\n            if (res && typeof res.status === 'number' && res.status >= 400) {\r\n                const msg = res.text || JSON.stringify(res.json || res);\r\n                console.error('LLM API Error Details:', { status: res.status, response: msg });\r\n                const err = new Error(`status ${res.status}: ${String(msg).slice(0, 200)}`);\r\n                err.status = res.status;\r\n                throw err;\r\n            }\r\n\r\n            let json = null;\r\n            if (res && res.json) json = res.json;\r\n            else if (res && typeof res.text === 'string') {\r\n                try { json = JSON.parse(res.text); } catch (_) { json = null; }\r\n            }\r\n\r\n            const textBody = (res && typeof res.text === 'string') ? res.text : (json ? JSON.stringify(json) : '');\r\n            if (textBody && textBody.trim().startsWith('<!DOCTYPE')) {\r\n                throw new Error(`API returned HTML error page. Check your API endpoint: ${this.settings.summaryApiEndpoint}`);\r\n            }\r\n\r\n            const content = json?.choices?.[0]?.message?.content;\r\n            if (!content) throw new Error(`Invalid API response format. Response: ${String(textBody).slice(0, 500)}`);\r\n\r\n            return content;\r\n        } catch (error) {\r\n            if (error && error.status) throw error;\r\n            throw new Error(error.message || String(error));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generic LLM prompt function\r\n     * @param {string} systemPrompt - System message\r\n     * @param {string} userContent - User message content\r\n     * @returns {Promise<string>} LLM response\r\n     */\r\n    async callLLMWithPrompt(systemPrompt, userContent) {\r\n        // log the prompt in file\r\n        console.log(\"LLM Prompt:\", { systemPrompt, userContent });\r\n        // view length\r\n        console.log(\"LLM Prompt Length:\", { systemPrompt: systemPrompt.length, userContent: userContent.length });\r\n        const requestBody = {\r\n            model: this.settings.summaryApiModel,\r\n            messages: [\r\n                { role: \"system\", content: systemPrompt },\r\n                { role: \"user\", content: userContent }\r\n            ]\r\n        };\r\n        return await this.callLLM(requestBody);\r\n    }\r\n\r\n    /**\r\n     * Get LLM summary of paper content\r\n     * @param {string} text - Paper content to summarize\r\n     * @returns {Promise<string>} Summary\r\n     */\r\n    async getSummary(text) {\r\n        return this.callLLMWithPrompt(\r\n            `=== Comprehensive Academic Article Summarizer ===\r\n<System>:\r\n\r\nYou are an Expert Academic Summarizer with a deep understanding of research methodologies, theoretical frameworks, and scholarly discourse. Your summaries maintain rigorous accuracy, capturing key arguments, methodologies, limitations, and implications without oversimplification. You avoid reducing complex ideas into mere bullet points while ensuring clarity and organization.\r\n\r\nWhen details are unclear, explicitly indicate gaps rather than filling them with assumptions. Where possible, use direct excerpts to preserve the integrity of the author\u2019s argument.\r\n<Context>:\r\n\r\nThe user will provide an academic article (journal paper, thesis, white paper, or research report) they want thoroughly summarized. They value in-depth understanding over quick takeaways, emphasizing research design, argumentation structure, and scholarly context.\r\n<Instructions>:\r\n\r\n    Identify the article\u2019s metadata (if available):\r\n\r\n        Title:\r\n\r\n        Author(s):\r\n\r\n        Publication Date:\r\n\r\n        Journal/Publisher:\r\n\r\n        Field/Discipline:\r\n\r\n        DOI/Link (if applicable):\r\n\r\n    Adapt summarization depth based on article type:\r\n\r\n        Empirical Studies \u2192 Focus on research question, methodology, data, results, and limitations.\r\n\r\n        Theoretical Papers \u2192 Focus on central arguments, frameworks, and implications.\r\n\r\n        Literature Reviews \u2192 Emphasize major themes, key sources, and synthesis of perspectives.\r\n\r\n        Meta-Analyses \u2192 Highlight statistical techniques, key findings, and research trends.\r\n\r\n    Include a multi-layered summary with these components:\r\n\r\n        (Optional) Executive Summary: A 3-5 sentence quick overview of the article.\r\n\r\n        Research Question & Objectives: Clearly define what the study aims to investigate.\r\n\r\n        Core Argument or Hypothesis: Summarize the main thesis or hypothesis tested.\r\n\r\n        Key Findings & Conclusions: Present the most important results and takeaways.\r\n\r\n        Methodology & Data: Describe how the study was conducted, including sample size, data sources, and analytical methods.\r\n\r\n        Theoretical Framework: Identify the theories, models, or intellectual traditions informing the study.\r\n\r\n        Results & Interpretation: Summarize key data points, statistical analyses, and their implications.\r\n\r\n        Limitations & Critiques: Note methodological constraints, potential biases, and gaps in the study.\r\n\r\n        Scholarly Context: Discuss how this paper fits into existing research, citing related works.\r\n\r\n        Practical & Theoretical Implications: Explain how the findings contribute to academia, policy, or real-world applications.\r\n\r\n    Handle uncertainty and gaps responsibly:\r\n\r\n        Clearly indicate when information is missing:\r\n\r\n            \u201CThe article does not specify\u2026\u201D\r\n\r\n            \u201CThe author implies X but does not explicitly state it\u2026\u201D\r\n\r\n        Do not infer unstated conclusions.\r\n\r\n        If the article presents contradictions, note them explicitly rather than resolving them artificially.\r\n\r\n    For cited references and sources:\r\n\r\n        Identify key studies referenced and their relevance.\r\n\r\n        Highlight intellectual debates the paper engages with.\r\n\r\n        If applicable, note paradigm shifts or major disagreements in the field.\r\n\r\n<Constraints>:\r\n\r\n\u2705 Prioritize accuracy and scholarly rigor over brevity.\r\n\u2705 Do not introduce external information not in the original article.\r\n\u2705 Maintain a neutral, academic tone.\r\n\u2705 Use direct excerpts where necessary to avoid misinterpretation.\r\n\u2705 Retain technical language where appropriate; do not oversimplify complex terms.\r\n<Output Format>:\r\nComprehensive Summary of [Article Title]\r\n\r\nAuthor(s): [Name(s)]\r\nPublication Date: [Year]\r\nJournal/Publisher: [Name]\r\nField/Discipline: [Field]\r\nDOI/Link: [If available]\r\n(Optional) Executive Summary\r\n\r\nA high-level overview (3-5 sentences) summarizing the article\u2019s key contributions.\r\nResearch Question & Objectives\r\n\r\n[Clearly state what the paper investigates.]\r\nCore Argument or Hypothesis\r\n\r\n[Summarize the main thesis or hypothesis.]\r\nKey Findings & Conclusions\r\n\r\n\u2022 [Finding 1]\r\n\u2022 [Finding 2]\r\n\u2022 (Continue as needed)\r\nMethodology & Data\r\n\r\n[Describe research design, sample size, data sources, and analysis methods.]\r\nTheoretical Framework\r\n\r\n[Identify key theories, models, or intellectual traditions used.]\r\nResults & Interpretation\r\n\r\n[Summarize key data points, statistical analyses, and their implications.]\r\nLimitations & Critiques\r\n\r\n[Discuss methodological constraints, biases, and gaps.]\r\nScholarly Context\r\n\r\n[How this study builds on, contradicts, or extends previous research.]\r\nPractical & Theoretical Implications\r\n\r\n[Discuss how findings contribute to academia, policy, or real-world applications.]`,\r\n            text\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Generate tags for paper content\r\n     * @param {string} text - Paper content\r\n     * @returns {Promise<string>} Comma-separated tags\r\n     */\r\n    async getTags(text) {\r\n        return this.callLLMWithPrompt(\r\n            \"You are a helpful assistant. Generate relevant academic tags for the following research paper content. Return only a comma-separated list of tags, no other text.\", \r\n            text\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Generate comprehensive resume/summary\r\n     * @param {string} text - Paper content\r\n     * @returns {Promise<string>} Detailed resume in markdown\r\n     */\r\n    async getResume(text) {\r\n        // If the provided text already contains a Resume or Summary section,\r\n        // return that section immediately and avoid calling the external LLM API.\r\n        // This helps prevent unnecessary API calls and preserves any existing\r\n        // human-authored summaries.\r\n        try {\r\n            const existing = String(text || \"\");\r\n            // Match a heading like '# Resume' or '## Summary' (any heading level)\r\n            // and capture everything until the next heading, a PDF embed, or EOF.\r\n            const resumeRegex = /(^|\\n)#{1,6}\\s*(Resume|Summary)\\b[^\\n]*\\n([\\s\\S]*?)(?=\\n#{1,6}\\s|\\n!\\[\\[.*?\\.pdf\\]\\]|$)/im;\r\n            const m = existing.match(resumeRegex);\r\n            if (m) {\r\n                // Return the found heading + body (trimmed)\r\n                const found = (m[0] || \"\").trim();\r\n                console.log('LLMService.getResume: existing resume/summary found; skipping LLM call.');\r\n                return found;\r\n            }\r\n        } catch (err) {\r\n            // Non-fatal: if our detection fails for any reason, fall back to calling the LLM\r\n            console.warn('LLMService.getResume: error while checking for existing resume:', err);\r\n        }\r\n\r\n        return this.callLLMWithPrompt(\r\n            `=== Comprehensive Academic Article Summarizer ===\r\n<System>:\r\n\r\nYou are an Expert Academic Summarizer with a deep understanding of research methodologies, theoretical frameworks, and scholarly discourse. Your summaries maintain rigorous accuracy, capturing key arguments, methodologies, limitations, and implications without oversimplification. You avoid reducing complex ideas into mere bullet points while ensuring clarity and organization.\r\n\r\nWhen details are unclear, explicitly indicate gaps rather than filling them with assumptions. Where possible, use direct excerpts to preserve the integrity of the author\u2019s argument.\r\n<Context>:\r\n\r\nThe user will provide an academic article (journal paper, thesis, white paper, or research report) they want thoroughly summarized. They value in-depth understanding over quick takeaways, emphasizing research design, argumentation structure, and scholarly context.\r\n<Instructions>:\r\n\r\n    Identify the article\u2019s metadata (if available):\r\n\r\n        Title:\r\n\r\n        Author(s):\r\n\r\n        Publication Date:\r\n\r\n        Journal/Publisher:\r\n\r\n        Field/Discipline:\r\n\r\n        DOI/Link (if applicable):\r\n\r\n    Adapt summarization depth based on article type:\r\n\r\n        Empirical Studies \u2192 Focus on research question, methodology, data, results, and limitations.\r\n\r\n        Theoretical Papers \u2192 Focus on central arguments, frameworks, and implications.\r\n\r\n        Literature Reviews \u2192 Emphasize major themes, key sources, and synthesis of perspectives.\r\n\r\n        Meta-Analyses \u2192 Highlight statistical techniques, key findings, and research trends.\r\n\r\n    Include a multi-layered summary with these components:\r\n\r\n        (Optional) Executive Summary: A 3-5 sentence quick overview of the article.\r\n\r\n        Research Question & Objectives: Clearly define what the study aims to investigate.\r\n\r\n        Core Argument or Hypothesis: Summarize the main thesis or hypothesis tested.\r\n\r\n        Key Findings & Conclusions: Present the most important results and takeaways.\r\n\r\n        Methodology & Data: Describe how the study was conducted, including sample size, data sources, and analytical methods.\r\n\r\n        Theoretical Framework: Identify the theories, models, or intellectual traditions informing the study.\r\n\r\n        Results & Interpretation: Summarize key data points, statistical analyses, and their implications.\r\n\r\n        Limitations & Critiques: Note methodological constraints, potential biases, and gaps in the study.\r\n\r\n        Scholarly Context: Discuss how this paper fits into existing research, citing related works.\r\n\r\n        Practical & Theoretical Implications: Explain how the findings contribute to academia, policy, or real-world applications.\r\n\r\n    Handle uncertainty and gaps responsibly:\r\n\r\n        Clearly indicate when information is missing:\r\n\r\n            \u201CThe article does not specify\u2026\u201D\r\n\r\n            \u201CThe author implies X but does not explicitly state it\u2026\u201D\r\n\r\n        Do not infer unstated conclusions.\r\n\r\n        If the article presents contradictions, note them explicitly rather than resolving them artificially.\r\n\r\n    For cited references and sources:\r\n\r\n        Identify key studies referenced and their relevance.\r\n\r\n        Highlight intellectual debates the paper engages with.\r\n\r\n        If applicable, note paradigm shifts or major disagreements in the field.\r\n\r\n<Constraints>:\r\n\r\n\u2705 Prioritize accuracy and scholarly rigor over brevity.\r\n\u2705 Do not introduce external information not in the original article.\r\n\u2705 Maintain a neutral, academic tone.\r\n\u2705 Use direct excerpts where necessary to avoid misinterpretation.\r\n\u2705 Retain technical language where appropriate; do not oversimplify complex terms.\r\n<Output Format>:\r\nComprehensive Summary of [Article Title]\r\n\r\nAuthor(s): [Name(s)]\r\nPublication Date: [Year]\r\nJournal/Publisher: [Name]\r\nField/Discipline: [Field]\r\nDOI/Link: [If available]\r\n(Optional) Executive Summary\r\n\r\nA high-level overview (3-5 sentences) summarizing the article\u2019s key contributions.\r\nResearch Question & Objectives\r\n\r\n[Clearly state what the paper investigates.]\r\nCore Argument or Hypothesis\r\n\r\n[Summarize the main thesis or hypothesis.]\r\nKey Findings & Conclusions\r\n\r\n\u2022 [Finding 1]\r\n\u2022 [Finding 2]\r\n\u2022 (Continue as needed)\r\nMethodology & Data\r\n\r\n[Describe research design, sample size, data sources, and analysis methods.]\r\nTheoretical Framework\r\n\r\n[Identify key theories, models, or intellectual traditions used.]\r\nResults & Interpretation\r\n\r\n[Summarize key data points, statistical analyses, and their implications.]\r\nLimitations & Critiques\r\n\r\n[Discuss methodological constraints, biases, and gaps.]\r\nScholarly Context\r\n\r\n[How this study builds on, contradicts, or extends previous research.]\r\nPractical & Theoretical Implications\r\n\r\n[Discuss how findings contribute to academia, policy, or real-world applications.]`, \r\n            text\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Test API configuration\r\n     * @returns {Promise<string>} Test response\r\n     */\r\n    async testApi() {\r\n        const testText = \"This is a test message for API configuration. If you see a summary of this, it works.\";\r\n        return await this.getSummary(testText);\r\n    }\r\n}\r\n\r\nmodule.exports = LLMService;", "const { requestUrl } = require('obsidian');\r\n\r\n/**\r\n * Service for handling paper metadata fetching and parsing\r\n */\r\nclass MetadataService {\r\n    /**\r\n     * Extract arXiv ID from URL\r\n     * @param {string} url - arXiv URL\r\n     * @returns {string|null} Extracted arXiv ID\r\n     */\r\n    extractArxivId(url) {\r\n        const regex = /arxiv\\.org\\/(?:abs|pdf|html)\\/(\\d{4}\\.\\d{4,5}(?:v\\d+)?|[a-zA-Z\\-\\.]+\\/\\d{7})/;\r\n        const match = url.match(regex);\r\n        return match ? match[1] : null;\r\n    }\r\n\r\n    /**\r\n     * Check if URL is a direct PDF link\r\n     * @param {string} url - URL to check\r\n     * @returns {boolean} True if direct PDF URL\r\n     */\r\n    isDirectPdfUrl(url) {\r\n        try {\r\n            const u = new URL(url);\r\n            return /\\.pdf$/i.test(u.pathname);\r\n        } catch (_) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Build metadata from direct PDF URL\r\n     * @param {string} url - Direct PDF URL\r\n     * @returns {Object} Metadata object\r\n     */\r\n    async buildMetadataFromDirectPdf(url) {\r\n        let fileNamePart = url.split('?')[0].split('#')[0].split('/').pop() || 'Untitled Paper';\r\n        fileNamePart = decodeURIComponent(fileNamePart).replace(/\\.pdf$/i, '');\r\n        const cleanedTitle = fileNamePart.replace(/[\\-_]+/g, ' ').replace(/\\s+/g, ' ').trim();\r\n        const today = new Date().toISOString().split('T')[0];\r\n        \r\n        return {\r\n            id: cleanedTitle.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, ''),\r\n            title: cleanedTitle || 'Untitled Paper',\r\n            authors: 'Unknown',\r\n            summary: 'No abstract available (added from direct PDF).',\r\n            published: today,\r\n            pdfLink: url\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Fetch paper metadata from arXiv API\r\n     * @param {string} arxivId - arXiv paper ID\r\n     * @returns {Object} Paper metadata\r\n     */\r\n    async fetchArxivMetadata(arxivId) {\r\n        const apiUrl = `http://export.arxiv.org/api/query?id_list=${arxivId}`;\r\n        const response = await requestUrl({ url: apiUrl });\r\n        \r\n        if (response.status !== 200) {\r\n            throw new Error('Failed to fetch from arXiv API.');\r\n        }\r\n\r\n        const xmlText = await response.text;\r\n        const parser = new DOMParser();\r\n        const xmlDoc = parser.parseFromString(xmlText, \"text/xml\");\r\n        const entry = xmlDoc.querySelector(\"entry\");\r\n        \r\n        if (!entry) {\r\n            throw new Error('Paper not found on arXiv.');\r\n        }\r\n\r\n        const getText = (tagName) => entry.querySelector(tagName)?.textContent.trim() || 'N/A';\r\n        const getAuthors = () => Array.from(entry.querySelectorAll(\"author name\"))\r\n            .map(el => el.textContent.trim())\r\n            .join(', ');\r\n\r\n        return {\r\n            id: getText(\"id\").split('/').pop(),\r\n            title: getText(\"title\").replace(/\\s+/g, ' '),\r\n            authors: getAuthors(),\r\n            summary: getText(\"summary\").replace(/\\s+/g, ' '),\r\n            published: getText(\"published\").split('T')[0],\r\n            pdfLink: entry.querySelector('link[title=\"pdf\"]')?.getAttribute('href') || ''\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get metadata from URL (either arXiv or direct PDF)\r\n     * @param {string} url - Paper URL\r\n     * @returns {Object} Paper metadata\r\n     */\r\n    async getMetadataFromUrl(url) {\r\n        const isPdf = this.isDirectPdfUrl(url);\r\n        \r\n        if (isPdf) {\r\n            return await this.buildMetadataFromDirectPdf(url);\r\n        } else {\r\n            const arxivId = this.extractArxivId(url);\r\n            if (!arxivId) {\r\n                throw new Error('Could not extract a valid arXiv ID or PDF link.');\r\n            }\r\n            return await this.fetchArxivMetadata(arxivId);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = MetadataService;", "// Utility functions for formatting and data processing\r\n\r\n/**\r\n * Normalize frontmatter tags into space separated #tag format for the index\r\n * @param {any} rawTags - Raw tags from frontmatter\r\n * @returns {string} Formatted tags string\r\n */\r\nfunction formatTagsForIndex(rawTags) {\r\n    if (!rawTags) return '';\r\n    let arr = [];\r\n    if (Array.isArray(rawTags)) {\r\n        arr = rawTags;\r\n    } else if (typeof rawTags === 'string') {\r\n        if (rawTags.includes(',')) arr = rawTags.split(',');\r\n        else arr = rawTags.split(/\\s+/);\r\n    } else {\r\n        try { arr = String(rawTags).split(/[,\\s]+/); } catch (_) { arr = []; }\r\n    }\r\n    return arr\r\n        .map(t => t.trim())\r\n        .filter(Boolean)\r\n        .map(t => {\r\n            const cleaned = t.replace(/^#+/, '').replace(/\\s+/g, '-');\r\n            return cleaned ? `#${cleaned}` : '';\r\n        })\r\n        .filter(Boolean)\r\n        .join(' ');\r\n}\r\n\r\n/**\r\n * Normalize frontmatter authors field\r\n * @param {any} fmAuthors - Authors from frontmatter\r\n * @returns {string} Normalized authors string\r\n */\r\nfunction normalizeAuthors(fmAuthors) {\r\n    if (!fmAuthors) return '';\r\n    if (Array.isArray(fmAuthors)) return fmAuthors.join(', ');\r\n    try { return String(fmAuthors); } catch (_) { return ''; }\r\n}\r\n\r\n/**\r\n * Normalize frontmatter tags field\r\n * @param {any} fmTags - Tags from frontmatter\r\n * @returns {string[]} Normalized tags array\r\n */\r\nfunction normalizeTags(fmTags) {\r\n    if (!fmTags) return [];\r\n    if (Array.isArray(fmTags)) return fmTags.map(t => String(t));\r\n    if (typeof fmTags === 'string') return fmTags.split(/[,\\s]+/).map(t => t.trim()).filter(Boolean);\r\n    try { return String(fmTags).split(/[,\\s]+/).map(t => t.trim()).filter(Boolean); } catch (_) { return []; }\r\n}\r\n\r\n/**\r\n * Generate a safe filename from paper metadata\r\n * @param {Object} metadata - Paper metadata\r\n * @returns {string} Safe filename for PDF\r\n */\r\nfunction generatePdfFileName(metadata) {\r\n    const sanitizedTitle = metadata.title.replace(/[\\\\/:\"*?<>|]/g, '-').substring(0, 100);\r\n    const firstAuthor = metadata.authors.split(',')[0].trim();\r\n    const year = new Date(metadata.published).getFullYear();\r\n    return `${firstAuthor} et al. - ${year} - ${sanitizedTitle}.pdf`;\r\n}\r\n\r\n/**\r\n * Create a sanitized note filename from title\r\n * @param {string} title - Paper title\r\n * @returns {string} Sanitized filename\r\n */\r\nfunction sanitizeNoteTitle(title) {\r\n    return title.replace(/[\\\\/:\"*?<>|]/g, '-').substring(0, 150);\r\n}\r\n\r\nmodule.exports = {\r\n    formatTagsForIndex,\r\n    normalizeAuthors,\r\n    normalizeTags,\r\n    generatePdfFileName,\r\n    sanitizeNoteTitle\r\n};", "const { requestUrl, TFile, Notice } = require('obsidian');\r\nconst { sanitizeNoteTitle, generatePdfFileName } = require('../utils/formatters');\r\n\r\n/**\r\n * Service for handling file operations (downloads, folder management, etc.)\r\n */\r\nclass FileService {\r\n    constructor(app, settings) {\r\n        this.app = app;\r\n        this.settings = settings;\r\n    }\r\n\r\n    /**\r\n     * Get effective folder path (with dot prefix if hidden)\r\n     * @param {string} folderPath - Base folder path\r\n     * @returns {string} Effective path\r\n     */\r\n    getEffectiveFolderPath(folderPath) {\r\n        if (this.settings.hideFolderFromFiles) {\r\n            if (folderPath.startsWith('.')) return folderPath;\r\n            return `.${folderPath}`;\r\n        }\r\n        return folderPath;\r\n    }\r\n\r\n    /**\r\n     * Ensure folder exists, create if necessary\r\n     * @param {string} folderPath - Folder path to ensure\r\n     */\r\n    async ensureFolderExists(folderPath) {\r\n        const effectivePath = this.getEffectiveFolderPath(folderPath);\r\n        if (!await this.app.vault.adapter.exists(effectivePath)) {\r\n            await this.app.vault.createFolder(effectivePath);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Download PDF file from URL\r\n     * @param {Object} metadata - Paper metadata\r\n     * @param {string} sector - Research sector\r\n     * @param {string} fileName - File name for the PDF\r\n     * @returns {Promise<string>} Logical vault path to the PDF\r\n     */\r\n    async downloadPdf(metadata, sector, fileName) {\r\n        if (!metadata.pdfLink) {\r\n            throw new Error('No PDF link found.');\r\n        }\r\n\r\n        // Store PDFs under a dedicated pdf/ subfolder inside the base research folder\r\n        const pdfBase = `${this.settings.pdfDownloadFolder}/pdf`;\r\n        const targetFolder = sector ? `${pdfBase}/${sector}` : pdfBase;\r\n        await this.ensureFolderExists(targetFolder);\r\n        \r\n        const targetEffective = this.getEffectiveFolderPath(targetFolder);\r\n        const filePath = `${targetEffective}/${fileName}`;\r\n        \r\n        // If already exists, return the logical path\r\n        if (await this.app.vault.adapter.exists(filePath)) {\r\n            new Notice(`PDF \"${fileName}\" already exists.`, 5000);\r\n            return `${pdfBase}/${sector}/${fileName}`.replace(/\\\\/g, '/');\r\n        }\r\n\r\n        const pdfResponse = await requestUrl({ \r\n            url: metadata.pdfLink, \r\n            method: 'GET', \r\n            throw: false \r\n        });\r\n        \r\n        if (!pdfResponse || (typeof pdfResponse.status === 'number' && pdfResponse.status !== 200)) {\r\n            throw new Error('Failed to download PDF.');\r\n        }\r\n\r\n        await this.app.vault.createBinary(filePath, pdfResponse.arrayBuffer);\r\n        \r\n        // Return logical vault path (not necessarily the effective dot-prefixed path)\r\n        return `${pdfBase}/${sector}/${fileName}`.replace(/\\\\/g, '/');\r\n    }\r\n\r\n    /**\r\n     * Create paper note file\r\n     * @param {Object} metadata - Paper metadata\r\n     * @param {string} sector - Research sector\r\n     * @param {string} pdfLogicalPath - Path to the PDF file\r\n     */\r\n    async createPaperNote(metadata, sector, pdfLogicalPath) {\r\n        const sectorFolder = `${this.settings.pdfDownloadFolder}/${sector}`;\r\n        await this.ensureFolderExists(sectorFolder);\r\n        \r\n        const sanitizedTitle = sanitizeNoteTitle(metadata.title);\r\n        const notePath = `${this.getEffectiveFolderPath(sectorFolder)}/${sanitizedTitle}.md`;\r\n        \r\n        if (await this.app.vault.adapter.exists(notePath)) {\r\n            new Notice(`Note \"${sanitizedTitle}.md\" already exists.`);\r\n            return;\r\n        }\r\n\r\n        const year = new Date(metadata.published).getFullYear();\r\n        \r\n        const markdownContent = `---\r\ntitle: \"${metadata.title.replace(/\"/g, '\\\\\"')}\"\r\nauthors: \"${metadata.authors.replace(/\"/g, '\\\\\"')}\"\r\nyear: ${year}\r\npublished: \"${metadata.published}\"\r\npdf_file: \"${pdfLogicalPath}\"\r\ntags: [paper, to-read]\r\n---\r\n# ${metadata.title}\r\n\r\n| Field | Value |\r\n|---|---|\r\n| **Title** | ${metadata.title} |\r\n| **Authors** | ${metadata.authors} |\r\n| **Date** | ${metadata.published} |\r\n| **Abstract**| ${metadata.summary} |\r\n\r\n**PDF link**: [pdf link](${pdfLogicalPath})\r\n\r\n---\r\n\r\n## Paper PDF\r\n![[${pdfLogicalPath}]]\r\n`;\r\n\r\n        await this.app.vault.create(notePath, markdownContent);\r\n    }\r\n\r\n    /**\r\n     * Delete paper and associated PDF\r\n     * @param {TFile} noteFile - The note file to delete\r\n     * @param {Object} paperData - Paper data from index\r\n     */\r\n    async deletePaper(noteFile, paperData) {\r\n        const frontmatter = paperData?.frontmatter || {};\r\n        let pdfFileName = frontmatter.pdf_file;\r\n        \r\n        if (!pdfFileName && frontmatter.title && frontmatter.authors && (frontmatter.published || frontmatter.year)) {\r\n            const legacyMetadata = {\r\n                title: frontmatter.title,\r\n                authors: frontmatter.authors,\r\n                published: frontmatter.published || String(frontmatter.year),\r\n            };\r\n            pdfFileName = generatePdfFileName(legacyMetadata);\r\n        }\r\n\r\n        let confirmMessage = `Permanently delete note \"${noteFile.basename}.md\"?`;\r\n        if (pdfFileName) {\r\n            confirmMessage += `\\n\\nThis will also attempt to delete the associated PDF: \"${pdfFileName}\".`;\r\n        }\r\n        confirmMessage += \"\\n\\nThis cannot be undone.\";\r\n        \r\n        if (!confirm(confirmMessage)) return;\r\n\r\n        try {\r\n            if (pdfFileName) {\r\n                // pdf_file may be a logical path (e.g. '_research-papers/pdf/LLM/file.pdf')\r\n                let pdfLogical = pdfFileName;\r\n                if (!pdfLogical.includes('/')) {\r\n                    pdfLogical = `${noteFile.parent.path}/${pdfLogical}`;\r\n                }\r\n                // resolve logical -> effective path (handles dot-prefixed folders)\r\n                const pdfEffective = await this.resolveLogicalToEffectivePath(pdfLogical);\r\n                const pdfFile = this.app.vault.getAbstractFileByPath(pdfEffective);\r\n                if (pdfFile) {\r\n                    await this.app.vault.delete(pdfFile);\r\n                }\r\n            }\r\n            \r\n            await this.app.vault.delete(noteFile);\r\n            new Notice('Paper deleted.');\r\n        } catch (error) {\r\n            console.error('Error deleting paper:', error);\r\n            new Notice('Failed to delete paper: ' + error.message);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Try to resolve a logical vault path to the actual effective path in the adapter\r\n     * This accounts for dot-prefixed hidden folders when settings.hideFolderFromFiles is true\r\n     * @param {string} logicalPath\r\n     * @returns {Promise<string>} effectivePath\r\n     */\r\n    async resolveLogicalToEffectivePath(logicalPath) {\r\n        // If the path already exists, return it\r\n        if (await this.app.vault.adapter.exists(logicalPath)) return logicalPath;\r\n\r\n        // Try dot-prefixed base folder\r\n        const parts = logicalPath.split('/');\r\n        if (parts.length > 0) {\r\n            parts[0] = '.' + parts[0];\r\n            const dotted = parts.join('/');\r\n            if (await this.app.vault.adapter.exists(dotted)) return dotted;\r\n        }\r\n\r\n        // Fallback to original logical path\r\n        return logicalPath;\r\n    }\r\n\r\n    /**\r\n     * Remove empty sector folders\r\n     */\r\n    async cleanEmptySectorFolders() {\r\n        const baseFolder = this.getEffectiveFolderPath(this.settings.pdfDownloadFolder);\r\n        \r\n        try {\r\n            if (!await this.app.vault.adapter.exists(baseFolder)) return;\r\n            \r\n            const listing = await this.app.vault.adapter.list(baseFolder);\r\n            \r\n            // Only iterate folders one level deep (sectors)\r\n            for (const folderPath of listing.folders) {\r\n                // Skip if baseFolder itself returned\r\n                if (folderPath === baseFolder) continue;\r\n                \r\n                const rel = folderPath.slice(baseFolder.length + 1);\r\n                if (!rel || rel.startsWith('_')) continue; // skip index / internal\r\n                \r\n                const subListing = await this.app.vault.adapter.list(folderPath);\r\n                const isEmpty = subListing.files.length === 0 && subListing.folders.length === 0;\r\n                \r\n                if (isEmpty) {\r\n                    try {\r\n                        await this.app.vault.adapter.rmdir(folderPath, true);\r\n                    } catch (err) {\r\n                        console.warn('Failed to remove empty sector folder', folderPath, err);\r\n                    }\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.warn('cleanEmptySectorFolders error', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Toggle folder visibility (hide/show with dot prefix)\r\n     * @param {boolean} hideFolder - Whether to hide the folder\r\n     * @param {Function} saveSettings - Function to save settings\r\n     * @param {Function} rebuildAndRefresh - Function to rebuild and refresh\r\n     */\r\n    async toggleFolderVisibility(hideFolder, saveSettings, rebuildAndRefresh) {\r\n        const oldHideValue = this.settings.hideFolderFromFiles;\r\n        const baseFolderName = this.settings.pdfDownloadFolder.replace(/^\\./, '');\r\n        const oldPath = oldHideValue ? `.${baseFolderName}` : baseFolderName;\r\n        const newPath = hideFolder ? `.${baseFolderName}` : baseFolderName;\r\n        \r\n        if (oldPath === newPath) return;\r\n\r\n        try {\r\n            const oldFolder = this.app.vault.getAbstractFileByPath(oldPath);\r\n            if (oldFolder) {\r\n                await this.app.fileManager.renameFile(oldFolder, newPath);\r\n                new Notice(`Folder moved from \"${oldPath}\" to \"${newPath}\"`);\r\n            }\r\n            \r\n            this.settings.hideFolderFromFiles = hideFolder;\r\n            await saveSettings();\r\n            await rebuildAndRefresh();\r\n        } catch (error) {\r\n            console.error('Error toggling folder visibility:', error);\r\n            new Notice(`Failed to change folder visibility: ${error.message}`);\r\n            this.settings.hideFolderFromFiles = oldHideValue;\r\n            await saveSettings();\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = FileService;", "const { TFile, Notice } = require('obsidian');\r\nconst { formatTagsForIndex, normalizeAuthors, normalizeTags } = require('../utils/formatters');\r\n\r\n/**\r\n * Service for managing paper index and operations\r\n */\r\nclass PaperService {\r\n    constructor(app, settings, fileService, pdfService) {\r\n        this.app = app;\r\n        this.settings = settings;\r\n        this.fileService = fileService;\r\n        this.pdfService = pdfService;\r\n        this.paperIndex = new Map();\r\n        this._rebuildTimer = null;\r\n        this._rebuildPending = false;\r\n    }\r\n\r\n    /**\r\n     * Check if file is a paper file\r\n     * @param {TFile} file - File to check\r\n     * @returns {boolean} True if paper file\r\n     */\r\n    isPaperFile(file) {\r\n        const paperFolder = this.fileService.getEffectiveFolderPath(this.settings.pdfDownloadFolder);\r\n        return file.path.startsWith(paperFolder) && !file.name.startsWith('_') && file.extension === 'md';\r\n    }\r\n\r\n    /**\r\n     * Parse paper file to extract data\r\n     * @param {TFile} file - Paper file\r\n     * @returns {Object|null} Paper data or null\r\n     */\r\n    async parsePaperFile(file) {\r\n        if (!this.isPaperFile(file)) return null;\r\n\r\n        const cache = this.app.metadataCache.getFileCache(file);\r\n        const frontmatter = cache?.frontmatter || {};\r\n        const paperFolder = this.fileService.getEffectiveFolderPath(this.settings.pdfDownloadFolder);\r\n        const relativePath = file.path.substring(paperFolder.length + 1);\r\n        const sector = relativePath.split('/')[0] || 'Other';\r\n\r\n        return {\r\n            path: file.path,\r\n            basename: file.basename,\r\n            mtime: file.stat.mtime,\r\n            frontmatter: frontmatter,\r\n            sector: sector,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Build paper index from all markdown files\r\n     */\r\n    async buildPaperIndex() {\r\n        this.paperIndex.clear();\r\n        const files = this.app.vault.getMarkdownFiles();\r\n        \r\n        for (const file of files) {\r\n            const paperData = await this.parsePaperFile(file);\r\n            if (paperData) {\r\n                this.paperIndex.set(file.path, paperData);\r\n            }\r\n        }\r\n        \r\n        console.log(`Paper index built with ${this.paperIndex.size} items.`);\r\n    }\r\n\r\n    /**\r\n     * Get all available sectors from folders and settings\r\n     * @returns {Promise<string[]>} Array of sector names\r\n     */\r\n    async getAvailableSectors() {\r\n        const settingsSectors = new Set(this.settings.sectors || ['Other']);\r\n        const folderPath = this.fileService.getEffectiveFolderPath(this.settings.pdfDownloadFolder);\r\n    \r\n        try {\r\n            if (await this.app.vault.adapter.exists(folderPath)) {\r\n                const list = await this.app.vault.adapter.list(folderPath);\r\n                // Extract the last part of the path (the folder name) for each folder\r\n                const folderSectors = list.folders.map(folder => folder.split('/').pop());\r\n                folderSectors.forEach(sector => settingsSectors.add(sector));\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Research Assistant: Could not scan for sector folders.\", error);\r\n        }\r\n    \r\n        if (settingsSectors.size === 0) {\r\n            settingsSectors.add('Other');\r\n        }\r\n    \r\n        const sortedSectors = Array.from(settingsSectors).sort();\r\n        \r\n        // Ensure 'Other' is always the last option in the list\r\n        if (sortedSectors.includes('Other')) {\r\n            return sortedSectors.filter(s => s !== 'Other').concat('Other');\r\n        }\r\n        \r\n        return sortedSectors;\r\n    }\r\n\r\n    /**\r\n     * Prune unused sectors from settings\r\n     * @param {Function} saveSettings - Function to save settings\r\n     */\r\n    async pruneUnusedSectors(saveSettings) {\r\n        const baseFolder = this.fileService.getEffectiveFolderPath(this.settings.pdfDownloadFolder);\r\n        const sectorCounts = new Map();\r\n        \r\n        for (const paper of this.paperIndex.values()) {\r\n            sectorCounts.set(paper.sector, (sectorCounts.get(paper.sector) || 0) + 1);\r\n        }\r\n        \r\n        let changed = false;\r\n        const managed = [...this.settings.sectors];\r\n        \r\n        for (const sector of managed) {\r\n            if (sector === 'Other') continue; // never prune Other\r\n            \r\n            const hasPapers = sectorCounts.has(sector);\r\n            const folderPath = `${baseFolder}/${sector}`;\r\n            let folderExists = false;\r\n            \r\n            try { \r\n                folderExists = await this.app.vault.adapter.exists(folderPath); \r\n            } catch (_) {}\r\n            \r\n            if (!hasPapers && !folderExists) {\r\n                this.settings.sectors = this.settings.sectors.filter(s => s !== sector);\r\n                if (this.settings.defaultSector === sector) {\r\n                    this.settings.defaultSector = 'Other';\r\n                }\r\n                changed = true;\r\n            }\r\n        }\r\n        \r\n        if (changed) await saveSettings();\r\n    }\r\n\r\n    /**\r\n     * Schedule rebuild with debouncing\r\n     * @param {number} delay - Delay in milliseconds\r\n     * @param {Function} rebuildAndRefresh - Function to rebuild and refresh\r\n     */\r\n    scheduleRebuild(delay = 300, rebuildAndRefresh) {\r\n        this._rebuildPending = true;\r\n        if (this._rebuildTimer) clearTimeout(this._rebuildTimer);\r\n        \r\n        this._rebuildTimer = setTimeout(async () => {\r\n            try {\r\n                await rebuildAndRefresh();\r\n            } finally {\r\n                this._rebuildPending = false;\r\n            }\r\n        }, delay);\r\n    }\r\n\r\n    /**\r\n     * Update master index file\r\n     */\r\n    async updateMasterIndex() {\r\n        const indexPath = `_papers_index.md`;\r\n        const sectors = await this.getAvailableSectors();\r\n        \r\n        let indexContent = \"# Master Paper Index\\n\\nThis file lists all research papers in the vault, grouped by sector.\\n\\n\";\r\n        const allPapers = Array.from(this.paperIndex.values());\r\n        \r\n        for (const sector of sectors) {\r\n            indexContent += `## ${sector}\\n\\n`;\r\n            indexContent += `| Title | Authors | Year | Tags | \\n`;\r\n            indexContent += `| --- | --- | --- | --- | \\n`;\r\n            \r\n            const sectorFiles = allPapers.filter(p => p.sector === sector);\r\n            sectorFiles.sort((a, b) => b.mtime - a.mtime);\r\n            \r\n            for (const paper of sectorFiles) {\r\n                const fm = paper.frontmatter;\r\n                const title = fm.title || paper.basename;\r\n                const authors = normalizeAuthors(fm.authors) || 'N/A';\r\n                const year = fm.year || 'N/A';\r\n                const displayTags = formatTagsForIndex(fm.tags) || '';\r\n                const pdfFileName = fm.pdf_file;\r\n                \r\n                let pdfCell = 'N/A';\r\n                if (pdfFileName) {\r\n                    // pdf_file is stored as a logical path like '_research-papers/pdf/LLM/file.pdf' or similar\r\n                    const safePdf = String(pdfFileName).replace(/\\\\\\\\/g, '/');\r\n                    // Use markdown link for master index table\r\n                    pdfCell = `[pdf link](${safePdf})`;\r\n                }\r\n                \r\n                indexContent += `| [[${paper.basename}]] | ${authors} | ${year} | ${displayTags} | ${pdfCell} |\\n`;\r\n            }\r\n\r\n            indexContent += `\\n`;\r\n        }\r\n        \r\n        const indexFile = this.app.vault.getAbstractFileByPath(indexPath);\r\n        if (indexFile instanceof TFile) {\r\n            await this.app.vault.modify(indexFile, indexContent);\r\n        } else {\r\n            await this.app.vault.create(indexPath, indexContent);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Process all papers with a given operation\r\n     * @param {Object} options - Processing options\r\n     */\r\n    async processAllPapers(options) {\r\n        const { commandName, processFn, shouldSkipFn } = options;\r\n        \r\n        try {\r\n            if (!this.settings.summaryApiEndpoint || !this.settings.summaryApiModel || !this.settings.summaryApiKey) {\r\n                new Notice('\u274C Please configure LLM API settings first.');\r\n                return;\r\n            }\r\n            \r\n            new Notice(`${commandName}...`);\r\n            const paperFiles = Array.from(this.paperIndex.values());\r\n            \r\n            if (paperFiles.length === 0) {\r\n                new Notice('No paper files found to process.');\r\n                return;\r\n            }\r\n            \r\n            let processedCount = 0, skippedCount = 0, errorCount = 0;\r\n            \r\n            for (const paperData of paperFiles) {\r\n                const paperFile = this.app.vault.getAbstractFileByPath(paperData.path);\r\n                if (!(paperFile instanceof TFile)) continue;\r\n                \r\n                try {\r\n                    const content = await this.app.vault.read(paperFile);\r\n                    if (await shouldSkipFn(content, paperData.frontmatter)) {\r\n                        skippedCount++;\r\n                        continue;\r\n                    }\r\n                    \r\n                    await processFn(paperFile, content);\r\n                    processedCount++;\r\n                } catch (error) {\r\n                    console.error(`Error during '${commandName}' for ${paperFile.name}:`, error);\r\n                    errorCount++;\r\n                }\r\n            }\r\n            \r\n            const message = `${commandName} complete! Processed: ${processedCount}, Skipped: ${skippedCount}, Errors: ${errorCount}`;\r\n            new Notice(message);\r\n        } catch (error) {\r\n            new Notice(`Error during ${commandName}: ${error.message}`);\r\n            console.error(`Error during ${commandName}:`, error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generate resumes for all papers\r\n     * @param {LLMService} llmService - LLM service instance\r\n     */\r\n    async generateResumeForPapers(llmService) {\r\n        await this.processAllPapers({\r\n            commandName: \"Resume Generation\",\r\n            // skip if there's already a Resume or Summary heading at any level (#, ##, etc.)\r\n            shouldSkipFn: async (content, frontmatter) => /^\\s*#{1,6}\\s+(Resume|Summary)/im.test(content),\r\n            processFn: async (paperFile, content) => {\r\n                // Prefer extracting text from attached PDF when available\r\n                const fm = this.app.metadataCache.getFileCache(paperFile)?.frontmatter || {};\r\n                let llmInput = content;\r\n                const pdfFileRef = fm.pdf_file;\r\n\r\n                if (pdfFileRef && this.pdfService) {\r\n                    try {\r\n                        // try to resolve the logical path to an actual TFile\r\n                        let logicalPath = String(pdfFileRef);\r\n                        // If frontmatter contains only a filename, resolve relative to the note's folder\r\n                        if (!logicalPath.includes('/') && paperFile.parent && paperFile.parent.path) {\r\n                            logicalPath = `${paperFile.parent.path}/${logicalPath}`;\r\n                        }\r\n                        const effectivePath = await this.fileService.resolveLogicalToEffectivePath(logicalPath);\r\n                        const pdfTFile = this.app.vault.getAbstractFileByPath(effectivePath);\r\n                        if (pdfTFile) {\r\n                            const extracted = await this.pdfService.extractTextFromPdf(pdfTFile);\r\n                            if (extracted && extracted.length > 20) {\r\n                                llmInput = extracted;\r\n                            } else {\r\n                                // If extraction yields little text, treat as failure per user request: don't generate resume\r\n                                new Notice(`\u274C PDF parsing yielded insufficient text for ${paperFile.basename}. Skipping resume generation.`);\r\n                                console.warn(`PDF parsing yielded insufficient text for ${paperFile.path}`);\r\n                                return; // skip LLM/resume for this paper\r\n                            }\r\n                        } else {\r\n                            // PDF file referenced but not found: do NOT generate resume\r\n                            new Notice(`\u274C PDF file not found for ${paperFile.basename}. Skipping resume generation.`);\r\n                            console.warn(`PDF file not found at resolved path: ${effectivePath} for ${paperFile.path}`);\r\n                            return; // skip LLM/resume for this paper\r\n                        }\r\n                    } catch (err) {\r\n                        console.error('PDF extraction failed for', paperFile.path, err);\r\n                        new Notice(`\u274C Failed to parse PDF for ${paperFile.basename}. Skipping resume generation.`);\r\n                        return; // skip calling LLM for this paper since parsing failed\r\n                    }\r\n                }\r\n\r\n                const resume = await llmService.getResume(llmInput);\r\n                // Prefer inserting the Resume section immediately before the \"## Paper PDF\" heading\r\n                // If that heading is not found, fall back to the PDF embed, then append at the end.\r\n                const paperPdfHeadingRegex = /^##\\s+Paper PDF/im;\r\n                const pdfEmbedRegex = /!\\[\\[.*?\\.pdf\\]\\]/i;\r\n\r\n                let newContent;\r\n                const paperPdfMatch = content.match(paperPdfHeadingRegex);\r\n                if (paperPdfMatch) {\r\n                    // insert before the heading's position\r\n                    const insertPosition = content.search(paperPdfHeadingRegex);\r\n                    newContent = content.slice(0, insertPosition) + `# Resume\\n\\n${resume}\\n\\n` + content.slice(insertPosition);\r\n                } else {\r\n                    const pdfMatch = content.match(pdfEmbedRegex);\r\n                    if (pdfMatch) {\r\n                        const insertPosition = content.indexOf(pdfMatch[0]);\r\n                        newContent = content.slice(0, insertPosition) + `# Resume\\n\\n${resume}\\n\\n` + content.slice(insertPosition);\r\n                    } else {\r\n                        newContent = content + `\\n\\n# Resume\\n\\n${resume}\\n`;\r\n                    }\r\n                }\r\n                \r\n                await this.app.vault.modify(paperFile, newContent);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Generate tags for all papers\r\n     * @param {LLMService} llmService - LLM service instance\r\n     */\r\n    async generateTagsForPapers(llmService) {\r\n        await this.processAllPapers({\r\n            commandName: \"Tag Generation\",\r\n            shouldSkipFn: async (content, frontmatter) => {\r\n                const existingTags = normalizeTags(frontmatter.tags);\r\n                const defaultTags = ['paper', 'to-read'];\r\n                return existingTags.some(tag => !defaultTags.includes(tag));\r\n            },\r\n            processFn: async (paperFile, content) => {\r\n                const generatedTags = await llmService.getTags(content);\r\n                const tagsArray = generatedTags.split(',').map(tag => tag.trim()).filter(Boolean);\r\n                const defaultTags = ['paper', 'to-read'];\r\n                const combinedTags = [...new Set([...defaultTags, ...tagsArray])];\r\n                \r\n                await this.app.fileManager.processFrontMatter(paperFile, (fm) => {\r\n                    fm.tags = combinedTags;\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Remove all '## Resume' or '## Summary' sections from paper files\r\n     * This will strip the heading and all content until the next top-level heading (## or #) or end of file.\r\n     */\r\n    async cleanAllResumes() {\r\n        const baseFiles = Array.from(this.paperIndex.values());\r\n        let modified = 0;\r\n        for (const paperData of baseFiles) {\r\n            const paperFile = this.app.vault.getAbstractFileByPath(paperData.path);\r\n            if (!(paperFile instanceof TFile)) continue;\r\n            try {\r\n                const content = await this.app.vault.read(paperFile);\r\n                // Remove section starting from a '# Resume' (or any heading level) up to the next PDF embed '![[...pdf]]'\r\n                // Keep the PDF embed intact.\r\n                // This regex matches a heading like '# Resume' / '## Resume' (case-insensitive) and any following text\r\n                // up until (but not including) the next PDF embed or end of file.\r\n                const resumeToPdfRegex = /# Resume([\\s\\S]*?)(?=!\\[\\[.*?\\.pdf\\]\\])/g;\r\n                if (resumeToPdfRegex.test(content)) {\r\n                    const newContent = content.replace(resumeToPdfRegex, '');\r\n                    await this.app.vault.modify(paperFile, newContent.trim() + '\\n');\r\n                    modified++;\r\n                }\r\n            } catch (err) {\r\n                console.error('Failed to clean resume for', paperData.path, err);\r\n            }\r\n        }\r\n        new Notice(`Cleaned resume sections in ${modified} files.`);\r\n    }\r\n}\r\n\r\nmodule.exports = PaperService;", "const { Notice } = require('obsidian');\r\n\r\n/**\r\n * PDF Service - extract text from PDF files using Obsidian's bundled PDF.js\r\n */\r\nclass PdfService {\r\n    constructor(app, settings) {\r\n        this.app = app;\r\n        this.settings = settings;\r\n        // safety cap for extracted text (very large PDFs can blow up prompts)\r\n        this.pdfjsLib = null; // Cache PDF.js library once loaded\r\n    }\r\n\r\n    /**\r\n     * Initialize PDF.js library - call this method to preload PDF.js\r\n     * @returns {Promise<boolean>} true if PDF.js is now available\r\n     */\r\n    async initializePdfJs() {\r\n        if (this.pdfjsLib) {\r\n            return true; // Already loaded\r\n        }\r\n\r\n        try {\r\n            // Try the same loading methods as extractTextFromPdf but cache the result\r\n            if (this.app && typeof this.app.loadPdfJs === 'function') {\r\n                try {\r\n                    this.pdfjsLib = await this.app.loadPdfJs();\r\n                    console.log('PDF.js initialized via app.loadPdfJs()');\r\n                    return true;\r\n                } catch (e) {\r\n                    console.warn('Failed to initialize PDF.js via app.loadPdfJs():', e);\r\n                }\r\n            }\r\n            \r\n            if (typeof window !== 'undefined' && window.pdfjsLib) {\r\n                this.pdfjsLib = window.pdfjsLib;\r\n                console.log('PDF.js initialized via window.pdfjsLib');\r\n                return true;\r\n            }\r\n\r\n            // Try to trigger PDF.js loading by opening a PDF temporarily\r\n            const pdfFiles = this.app.vault.getFiles().filter(f => f.extension === 'pdf');\r\n            if (pdfFiles.length > 0) {\r\n                console.log('Attempting to initialize PDF.js by opening a PDF...');\r\n                const leaf = this.app.workspace.getLeaf(false);\r\n                await leaf.openFile(pdfFiles[0]);\r\n                \r\n                // Wait for PDF.js to load\r\n                await new Promise(resolve => setTimeout(resolve, 2000));\r\n                \r\n                if (leaf.view && leaf.view.renderer && leaf.view.renderer.pdfjs) {\r\n                    this.pdfjsLib = leaf.view.renderer.pdfjs;\r\n                    console.log('PDF.js initialized via temporary PDF view');\r\n                    leaf.detach();\r\n                    return true;\r\n                }\r\n                \r\n                leaf.detach();\r\n            }\r\n\r\n            return false;\r\n        } catch (error) {\r\n            console.error('Failed to initialize PDF.js:', error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Extract full text from a PDF TFile using PDF.js loaded from Obsidian.\r\n     * Returns the extracted text (string). Throws on errors.\r\n     * @param {TFile} pdfFile\r\n     * @returns {Promise<string>} extracted text\r\n     */\r\n    async extractTextFromPdf(pdfFile) {\r\n        if (!pdfFile) throw new Error('No PDF file provided');\r\n\r\n        try {\r\n            // read binary data from vault\r\n            const arrayBuffer = await this.app.vault.readBinary(pdfFile);\r\n\r\n            // Try multiple methods to load PDF.js\r\n            let pdfjsLib = this.pdfjsLib; // Use cached version if available\r\n            \r\n            if (!pdfjsLib) {\r\n                // Method 1: Try Obsidian's newer loadPdfJs method\r\n                if (this.app && typeof this.app.loadPdfJs === 'function') {\r\n                    try {\r\n                        pdfjsLib = await this.app.loadPdfJs();\r\n                        this.pdfjsLib = pdfjsLib; // Cache it\r\n                        console.log('PDF.js loaded via app.loadPdfJs()');\r\n                    } catch (e) {\r\n                        console.warn('Failed to load PDF.js via app.loadPdfJs():', e);\r\n                    }\r\n                }\r\n                \r\n                // Method 2: Try global window object\r\n                if (!pdfjsLib && typeof window !== 'undefined' && window.pdfjsLib) {\r\n                    pdfjsLib = window.pdfjsLib;\r\n                    this.pdfjsLib = pdfjsLib; // Cache it\r\n                    console.log('PDF.js loaded via window.pdfjsLib');\r\n                }\r\n                \r\n                // Method 3: Try Obsidian's internal PDF.js (newer approach)\r\n                if (!pdfjsLib && this.app.workspace) {\r\n                    try {\r\n                        // Check if Obsidian has PDF.js loaded internally\r\n                        const pdfViews = this.app.workspace.getLeavesOfType('pdf');\r\n                        if (pdfViews.length > 0) {\r\n                            // Try to access PDF.js from an existing PDF view\r\n                            const pdfView = pdfViews[0].view;\r\n                            if (pdfView && pdfView.renderer && pdfView.renderer.pdfjs) {\r\n                                pdfjsLib = pdfView.renderer.pdfjs;\r\n                                this.pdfjsLib = pdfjsLib; // Cache it\r\n                                console.log('PDF.js loaded via existing PDF view');\r\n                            }\r\n                        }\r\n                    } catch (e) {\r\n                        console.warn('Failed to load PDF.js via PDF view:', e);\r\n                    }\r\n                }\r\n                \r\n                // Method 4: Try to trigger PDF.js loading by creating a temporary PDF view\r\n                if (!pdfjsLib) {\r\n                    try {\r\n                        console.log('Attempting to load PDF.js by opening PDF temporarily...');\r\n                        const leaf = this.app.workspace.getLeaf(false);\r\n                        await leaf.openFile(pdfFile);\r\n                        \r\n                        // Wait a bit for PDF.js to load\r\n                        await new Promise(resolve => setTimeout(resolve, 1000));\r\n                        \r\n                        if (leaf.view && leaf.view.renderer && leaf.view.renderer.pdfjs) {\r\n                            pdfjsLib = leaf.view.renderer.pdfjs;\r\n                            this.pdfjsLib = pdfjsLib; // Cache it\r\n                            console.log('PDF.js loaded via temporary PDF view');\r\n                        }\r\n                        \r\n                        // Close the temporary view\r\n                        leaf.detach();\r\n                    } catch (e) {\r\n                        console.warn('Failed to load PDF.js via temporary view:', e);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!pdfjsLib) {\r\n                // If all methods fail, provide a helpful error message\r\n                const errorMsg = 'PDF.js not available. Please open a PDF file in Obsidian first to initialize PDF.js, then try again.';\r\n                throw new Error(errorMsg);\r\n            }\r\n\r\n            const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });\r\n            const pdf = await loadingTask.promise;\r\n\r\n            let fullText = '';\r\n            for (let i = 1; i <= pdf.numPages; i++) {\r\n                const page = await pdf.getPage(i);\r\n                const content = await page.getTextContent();\r\n                const pageText = content.items.map(item => (item && item.str) ? item.str : '').join(' ');\r\n                fullText += `\\n\\n---- Page ${i} ----\\n\\n` + pageText;\r\n            }\r\n\r\n            try { if (pdf && typeof pdf.destroy === 'function') pdf.destroy(); } catch (_) {}\r\n\r\n            return fullText.trim();\r\n        } catch (error) {\r\n            console.error('PdfService.extractTextFromPdf error', error);\r\n            throw error;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = PdfService;\r\n", "const { ItemView, TFile } = require('obsidian');\r\n\r\n// Define a unique identifier for our new view\r\nconst PAPER_EXPLORER_VIEW_TYPE = \"paper-explorer-view\";\r\n\r\nclass PaperExplorerView extends ItemView {\r\n    constructor(leaf, settings, plugin) {\r\n        super(leaf);\r\n        this.settings = settings;\r\n        this.plugin = plugin;\r\n    }\r\n\r\n    getViewType() { \r\n        return PAPER_EXPLORER_VIEW_TYPE; \r\n    }\r\n    \r\n    getDisplayText() { \r\n        return \"Research Papers\"; \r\n    }\r\n    \r\n    getIcon() { \r\n        return \"library\"; \r\n    }\r\n\r\n    async onOpen() {\r\n        // Ensure index and artifacts are up-to-date when view opens\r\n        try {\r\n            // If plugin hasn't built the index yet, trigger a quick rebuild\r\n            if (!this.plugin || !this.plugin.paperService.paperIndex || this.plugin.paperService.paperIndex.size === 0) {\r\n                await this.plugin.rebuildAndRefresh();\r\n            }\r\n        } catch (e) {\r\n            console.warn('Error rebuilding paper index on open:', e);\r\n        }\r\n        this.renderView();\r\n    }\r\n\r\n    async renderView() {\r\n        const container = this.contentEl || this.containerEl.children[1];\r\n        container.empty();\r\n\r\n        const header = container.createEl(\"div\", { cls: \"paper-explorer-header\" });\r\n        this.createHomeViewerButton(header);\r\n        this.createAddPaperButton(header);\r\n\r\n        const layout = container.createEl('div', { cls: 'paper-explorer-layout' });\r\n        const sidebar = layout.createEl('div', { cls: 'paper-explorer-sidebar' });\r\n        const contentArea = layout.createEl('div', { cls: 'paper-explorer-content' });\r\n        \r\n        await this.createSectorSelector(sidebar);\r\n        await this.renderPaperTable(contentArea);\r\n    }\r\n\r\n    createHomeViewerButton(header) {\r\n        const viewerBtn = document.createElement('button');\r\n        viewerBtn.style.border = 'none';\r\n        viewerBtn.style.background = 'none';\r\n        viewerBtn.style.cursor = 'pointer';\r\n        viewerBtn.style.padding = '0';\r\n        viewerBtn.style.margin = '0';\r\n        viewerBtn.style.color = 'var(--text-normal)';\r\n        viewerBtn.style.boxShadow = 'none';\r\n        \r\n        viewerBtn.innerHTML = '<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path><polyline points=\"9 22 9 12 15 12 15 22\"></polyline></svg><span style=\"margin-left:4px;\">Open Home Viewer</span>';\r\n        viewerBtn.style.fontSize = '0.75rem';\r\n        viewerBtn.title = 'Open Home Viewer.md';\r\n        \r\n        viewerBtn.addEventListener('click', async (e) => {\r\n            e.preventDefault();\r\n            const viewerPath = \"/_papers_index.md\";\r\n            let file = this.plugin.app.vault.getAbstractFileByPath(viewerPath);\r\n            if (!file) {\r\n                file = await this.plugin.app.vault.create(viewerPath, '# Viewer\\n');\r\n            }\r\n            if (file instanceof TFile) {\r\n                const leaf = this.plugin.app.workspace.getLeaf(false);\r\n                await leaf.openFile(file);\r\n            }\r\n        });\r\n        \r\n        header.appendChild(viewerBtn);\r\n    }\r\n\r\n    createAddPaperButton(header) {\r\n        const buttonContainer = header.createEl('div', { cls: 'button-container' });\r\n        buttonContainer.style.display = 'flex';\r\n        buttonContainer.style.justifyContent = 'center';\r\n        \r\n        const addButton = buttonContainer.createEl(\"button\", { text: \"+ Add Paper\" });\r\n        addButton.style.fontSize = '1em';\r\n        addButton.style.padding = '10px 20px';\r\n        addButton.style.borderRadius = '5px';\r\n        addButton.style.border = 'none';\r\n        addButton.style.cursor = 'pointer';\r\n        addButton.style.marginBottom = '10px';\r\n        addButton.addClass(\"mod-cta\");\r\n        \r\n        addButton.addEventListener(\"click\", () => {\r\n            this.plugin.openAddPaperModal();\r\n        });\r\n    }\r\n\r\n    async createSectorSelector(sidebar) {\r\n        const sectors = await this.plugin.paperService.getAvailableSectors();\r\n        const sectorWrap = sidebar.createEl('div', { cls: 'sector-select-wrap' });\r\n        sectorWrap.style.width = '100%';\r\n        sectorWrap.createEl('hr');\r\n\r\n        const select = sectorWrap.createEl('select', { cls: 'sector-select' });\r\n        select.style.marginTop = '24px';\r\n        const space = sectorWrap.createEl('div', { cls: 'sector-select-space' });\r\n        space.style.height = '24px';\r\n        select.style.width = '100%';\r\n        select.createEl('option', { value: 'All', text: 'All Sectors' });\r\n\r\n        for (const s of sectors) {\r\n            select.createEl('option', { value: s, text: s });\r\n        }\r\n\r\n        const active = this.plugin._activeSector || 'All';\r\n        if (!sectors.includes(active) && active !== 'All') {\r\n            this.plugin._activeSector = 'All';\r\n        }\r\n        try { \r\n            select.value = this.plugin._activeSector || 'All'; \r\n        } catch (e) { \r\n            select.value = 'All'; \r\n        }\r\n\r\n        select.addEventListener('change', (ev) => {\r\n            const val = ev.target.value;\r\n            this.plugin._activeSector = val === 'All' ? 'All' : val;\r\n            this.renderView();\r\n        });\r\n    }\r\n\r\n    async renderPaperTable(contentArea) {\r\n        const allPapers = Array.from(this.plugin.paperService.paperIndex.values());\r\n        const paperNotes = allPapers.filter(paper => {\r\n            if (this.plugin._activeSector && this.plugin._activeSector !== 'All') {\r\n                return paper.sector === this.plugin._activeSector;\r\n            }\r\n            return true;\r\n        });\r\n\r\n        if (paperNotes.length === 0) {\r\n            contentArea.createEl(\"p\", { text: \"No papers found. Click 'Add Paper' to start.\" });\r\n            return;\r\n        }\r\n\r\n        const table = contentArea.createEl(\"table\", { cls: \"paper-index-table\" });\r\n        table.style.width = '100%';\r\n        table.style.borderCollapse = 'separate';\r\n        table.style.borderSpacing = '0 24px';\r\n        \r\n        const thead = table.createEl(\"thead\");\r\n        const headerRow = thead.createEl(\"tr\");\r\n        headerRow.createEl(\"th\", { text: \"Title\" });\r\n\r\n        const tbody = table.createEl(\"tbody\");\r\n        paperNotes.sort((a, b) => b.mtime - a.mtime);\r\n\r\n        for (const paper of paperNotes) {\r\n            const title = paper.frontmatter.title || paper.basename;\r\n            const row = tbody.createEl(\"tr\");\r\n            row.style.cursor = 'pointer';\r\n            row.style.marginTop = '4px';\r\n\r\n            const titleCell = row.createEl(\"td\");\r\n            titleCell.setText(title);\r\n            titleCell.addClass('paper-title-cell');\r\n            titleCell.addEventListener('click', () => {\r\n                this.app.workspace.openLinkText(paper.path, '', false);\r\n            });\r\n            \r\n            this.createDeleteButton(row, paper);\r\n        }\r\n    }\r\n\r\n    createDeleteButton(row, paper) {\r\n        const deleteCell = row.createEl('td');\r\n        const deleteBtn = deleteCell.createEl('button', { text: '\u00D7' });\r\n        deleteBtn.addClass('paper-delete-btn');\r\n        deleteBtn.title = 'Delete paper note and associated PDF';\r\n        deleteBtn.style.cursor = 'pointer';\r\n        deleteBtn.style.background = 'transparent';\r\n        deleteBtn.style.border = 'none';\r\n        deleteBtn.style.color = '#c94b4b';\r\n        deleteBtn.style.fontSize = '1.1em';\r\n        deleteBtn.style.padding = '4px 8px';\r\n        deleteBtn.style.boxShadow = 'none';\r\n        \r\n        deleteBtn.addEventListener('click', async (ev) => {\r\n            ev.stopPropagation();\r\n            const fileToDelete = this.app.vault.getAbstractFileByPath(paper.path);\r\n            if (fileToDelete instanceof TFile) {\r\n                await this.plugin.deletePaper(fileToDelete);\r\n            } else {\r\n                new Notice(\"Error: Could not find file to delete.\");\r\n                this.plugin.rebuildAndRefresh();\r\n            }\r\n        });\r\n    }\r\n\r\n    async onClose() {}\r\n}\r\n\r\nmodule.exports = { PaperExplorerView, PAPER_EXPLORER_VIEW_TYPE };", "const { ItemView, TFile } = require('obsidian');\r\n\r\n// Define a unique identifier for our chat panel view\r\nconst CHAT_PANEL_VIEW_TYPE = \"chat-panel-view\";\r\n\r\nclass ChatPanelView extends ItemView {\r\n    constructor(leaf, settings, plugin) {\r\n        super(leaf);\r\n        this.settings = settings;\r\n        this.plugin = plugin;\r\n        this.chatHistory = [];\r\n        this.currentNoteContent = '';\r\n        this.currentPdfContent = '';\r\n        this.currentNoteFile = null;\r\n        this.messageHistoryIndex = -1; // For navigating sent messages\r\n        this.userMessageHistory = []; // Store user messages for navigation\r\n        this.isUserScrolling = false; // Track if user is manually scrolling\r\n        this.conversations = new Map(); // Store conversations per paper\r\n    }\r\n\r\n    getViewType() { \r\n        return CHAT_PANEL_VIEW_TYPE; \r\n    }\r\n    \r\n    getDisplayText() { \r\n        return \"Note Chat\"; \r\n    }\r\n    \r\n    getIcon() { \r\n        return \"message-circle\"; \r\n    }\r\n\r\n    async onOpen() {\r\n        this.renderView();\r\n        this.setupEventListeners();\r\n    }\r\n\r\n    setupEventListeners() {\r\n        // Listen for active file changes\r\n        this.registerEvent(\r\n            this.app.workspace.on('active-leaf-change', () => {\r\n                this.updateCurrentNote();\r\n            })\r\n        );\r\n\r\n        // Listen for file content changes\r\n        this.registerEvent(\r\n            this.app.vault.on('modify', (file) => {\r\n                if (file === this.currentNoteFile) {\r\n                    this.updateCurrentNote();\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    async updateCurrentNote() {\r\n        const activeFile = this.app.workspace.getActiveFile();\r\n        \r\n        if (!activeFile || activeFile.extension !== 'md') {\r\n            // Save current conversation before switching\r\n            if (this.currentNoteFile) {\r\n                await this.saveConversation();\r\n            }\r\n            \r\n            this.currentNoteFile = null;\r\n            this.currentNoteContent = '';\r\n            this.currentPdfContent = '';\r\n            this.chatHistory = [];\r\n            this.userMessageHistory = [];\r\n            this.messageHistoryIndex = -1;\r\n            this.updateNoteInfo();\r\n            this.renderChatHistory();\r\n            return;\r\n        }\r\n\r\n        // Save current conversation before switching to new file\r\n        if (this.currentNoteFile && this.currentNoteFile.path !== activeFile.path) {\r\n            await this.saveConversation();\r\n        }\r\n\r\n        this.currentNoteFile = activeFile;\r\n        \r\n        try {\r\n            // Read note content\r\n        this.currentNoteContent = await this.app.vault.read(activeFile);\r\n            \r\n            // Check for associated PDF\r\n            this.currentPdfContent = '';\r\n            this.pdfExtractionError = null;  // Clear previous PDF errors\r\n            const paperData = this.plugin.paperService.paperIndex.get(activeFile.path);\r\n            \r\n            console.log('Chat Panel Debug - PDF Detection:', {\r\n                activeFilePath: activeFile.path,\r\n                paperDataExists: !!paperData,\r\n                paperData: paperData,\r\n                frontmatter: paperData?.frontmatter,\r\n                pdfFile: paperData?.frontmatter?.pdf_file\r\n            });\r\n            \r\n            if (paperData && paperData.frontmatter && paperData.frontmatter.pdf_file) {\r\n                try {\r\n                    // Handle pdf_file path resolution (similar to paper-service.js)\r\n                    let logicalPath = String(paperData.frontmatter.pdf_file);\r\n                    // If frontmatter contains only a filename, resolve relative to the note's folder\r\n                    if (!logicalPath.includes('/') && activeFile.parent && activeFile.parent.path) {\r\n                        logicalPath = `${activeFile.parent.path}/${logicalPath}`;\r\n                    }\r\n                    \r\n                    // Try to resolve the logical path to effective path\r\n                    let effectivePath = logicalPath;\r\n                    if (this.plugin.fileService && this.plugin.fileService.resolveLogicalToEffectivePath) {\r\n                        effectivePath = await this.plugin.fileService.resolveLogicalToEffectivePath(logicalPath);\r\n                    }\r\n                    \r\n                    const pdfFile = this.app.vault.getAbstractFileByPath(effectivePath);\r\n                    console.log('Chat Panel Debug - PDF File:', {\r\n                        originalPdfFile: paperData.frontmatter.pdf_file,\r\n                        logicalPath: logicalPath,\r\n                        effectivePath: effectivePath,\r\n                        pdfFileExists: !!pdfFile,\r\n                        pdfFileType: pdfFile?.constructor?.name,\r\n                        pdfExtension: pdfFile?.extension\r\n                    });\r\n                    \r\n                    if (pdfFile instanceof TFile && pdfFile.extension === 'pdf') {\r\n                        console.log('Chat Panel Debug - Extracting PDF text...');\r\n                        try {\r\n                            this.currentPdfContent = await this.plugin.pdfService.extractTextFromPdf(pdfFile);\r\n                            console.log('Chat Panel Debug - PDF extraction complete:', {\r\n                                textLength: this.currentPdfContent.length,\r\n                                preview: this.currentPdfContent.slice(0, 200) + '...'\r\n                            });\r\n                        } catch (pdfExtractionError) {\r\n                            console.warn('PDF extraction failed:', pdfExtractionError);\r\n                            // Store the error details for user feedback\r\n                            this.pdfExtractionError = pdfExtractionError.message;\r\n                        }\r\n                    }\r\n                } catch (pdfError) {\r\n                    console.warn('Could not extract PDF content for chat:', pdfError);\r\n                }\r\n            }\r\n            \r\n            this.updateNoteInfo();\r\n            \r\n            // Load conversation for this paper\r\n            await this.loadConversation();\r\n        } catch (error) {\r\n            console.error('Error updating current note for chat:', error);\r\n        }\r\n    }\r\n\r\n    updateNoteInfo() {\r\n        const noteInfoEl = this.contentEl.querySelector('.chat-note-info');\r\n        if (!noteInfoEl) return;\r\n\r\n        if (this.currentNoteFile) {\r\n            const hasPdf = this.currentPdfContent.length > 0;\r\n            const paperData = this.plugin.paperService.paperIndex.get(this.currentNoteFile.path);\r\n            const pdfFile = paperData?.frontmatter?.pdf_file;\r\n            \r\n            let pdfStatusText = '';\r\n            if (hasPdf) {\r\n                pdfStatusText = ` \u2022 \uD83D\uDCCB PDF attached (${this.currentPdfContent.length} chars)`;\r\n            } else if (pdfFile && this.pdfExtractionError) {\r\n                if (this.pdfExtractionError.includes('PDF.js not available')) {\r\n                    pdfStatusText = ` \u2022 \u26A0\uFE0F PDF found but PDF.js not loaded - try opening a PDF file first`;\r\n                } else {\r\n                    pdfStatusText = ` \u2022 \u26A0\uFE0F PDF extraction failed: ${this.pdfExtractionError}`;\r\n                }\r\n            } else if (pdfFile) {\r\n                pdfStatusText = ` \u2022 \u26A0\uFE0F PDF file found but not loaded: ${pdfFile}`;\r\n            } else {\r\n                pdfStatusText = ' \u2022 No PDF file in frontmatter';\r\n            }\r\n            \r\n            noteInfoEl.innerHTML = `\r\n                <div class=\"chat-current-note\">\r\n                    <div class=\"note-name\">${this.currentNoteFile.basename}</div>\r\n                    <div class=\"note-status\">\r\n                        \uD83D\uDCC4 Note (${this.currentNoteContent.length} chars)${pdfStatusText}\r\n                    </div>\r\n                </div>\r\n            `;\r\n        } else {\r\n            noteInfoEl.innerHTML = `\r\n                <div class=\"chat-no-note\">\r\n                    <div class=\"no-note-message\">No active note</div>\r\n                    <div class=\"no-note-help\">Open a markdown file to start chatting about it</div>\r\n                </div>\r\n            `;\r\n        }\r\n    }\r\n\r\n    async renderView() {\r\n        const container = this.contentEl || this.containerEl.children[1];\r\n        container.empty();\r\n        container.addClass('chat-panel-container');\r\n\r\n        // Header with current note info\r\n        const header = container.createEl('div', { cls: 'chat-panel-header' });\r\n        header.createEl('h3', { text: 'Chat with Note', cls: 'chat-panel-title' });\r\n        \r\n        const noteInfo = header.createEl('div', { cls: 'chat-note-info' });\r\n\r\n        // Chat messages area\r\n        const chatArea = container.createEl('div', { cls: 'chat-messages-area' });\r\n        this.chatMessagesEl = chatArea;\r\n\r\n        // Add scroll event listener for scroll lock functionality\r\n        chatArea.addEventListener('scroll', () => {\r\n            const { scrollTop, scrollHeight, clientHeight } = chatArea;\r\n            const isAtBottom = scrollTop + clientHeight >= scrollHeight - 5; // 5px threshold\r\n            this.isUserScrolling = !isAtBottom;\r\n        });\r\n\r\n        // Input area\r\n        const inputArea = container.createEl('div', { cls: 'chat-input-area' });\r\n        \r\n        const inputContainer = inputArea.createEl('div', { cls: 'chat-input-container' });\r\n        \r\n        this.messageInput = inputContainer.createEl('textarea', {\r\n            cls: 'chat-message-input',\r\n            attr: {\r\n                placeholder: 'Ask questions about the current note and PDF...',\r\n                rows: '3'\r\n            }\r\n        });\r\n        \r\n        const sendButton = inputContainer.createEl('button', {\r\n            cls: 'chat-send-button',\r\n            text: 'Send'\r\n        });\r\n\r\n        // Event listeners\r\n        sendButton.addEventListener('click', () => this.sendMessage());\r\n        this.messageInput.addEventListener('keydown', (e) => {\r\n            if (e.key === 'Enter') {\r\n                if (e.shiftKey) {\r\n                    // Shift+Enter: Allow new line (default behavior)\r\n                    return;\r\n                } else if (e.ctrlKey || e.metaKey) {\r\n                    // Ctrl+Enter: Send message (legacy support)\r\n                    e.preventDefault();\r\n                    this.sendMessage();\r\n                } else {\r\n                    // Enter: Send message (primary behavior)\r\n                    e.preventDefault();\r\n                    this.sendMessage();\r\n                }\r\n            } else if (e.key === 'Escape') {\r\n                // Escape: Clear input\r\n                e.preventDefault();\r\n                this.messageInput.value = '';\r\n                this.messageInput.style.height = 'auto'; // Reset height if auto-resizing\r\n            } else if (e.key === 'ArrowUp' && e.ctrlKey) {\r\n                // Ctrl+Up: Navigate to previous message for editing\r\n                e.preventDefault();\r\n                this.navigateMessageHistory(-1);\r\n            } else if (e.key === 'ArrowDown' && e.ctrlKey) {\r\n                // Ctrl+Down: Navigate to next message for editing\r\n                e.preventDefault();\r\n                this.navigateMessageHistory(1);\r\n            }\r\n        });\r\n\r\n        // Auto-resize textarea\r\n        this.messageInput.addEventListener('input', () => {\r\n            this.autoResizeTextarea();\r\n        });\r\n\r\n        // Clear chat button\r\n        const clearButton = inputArea.createEl('button', {\r\n            cls: 'chat-clear-button',\r\n            text: 'Clear Chat'\r\n        });\r\n        clearButton.addEventListener('click', () => this.clearChat());\r\n\r\n        // Search button\r\n        const searchButton = inputArea.createEl('button', {\r\n            cls: 'chat-search-button',\r\n            text: 'Search'\r\n        });\r\n        searchButton.addEventListener('click', () => this.toggleSearch());\r\n\r\n        // Export conversation button\r\n        const exportButton = inputArea.createEl('button', {\r\n            cls: 'chat-export-button',\r\n            text: 'Export'\r\n        });\r\n        exportButton.addEventListener('click', () => this.exportConversation());\r\n\r\n        // Test API button\r\n        const testApiButton = inputArea.createEl('button', {\r\n            cls: 'chat-test-api-button',\r\n            text: 'Test API'\r\n        });\r\n        testApiButton.addEventListener('click', () => this.testApiConnection());\r\n\r\n        await this.updateCurrentNote();\r\n        this.renderChatHistory();\r\n\r\n        // Add CSS styles\r\n        this.addStyles();\r\n    }\r\n\r\n    async sendMessage() {\r\n        const message = this.messageInput.value.trim();\r\n        if (!message) return;\r\n\r\n        if (!this.currentNoteFile) {\r\n            this.addMessageToHistory('system', 'Please open a markdown file first.');\r\n            return;\r\n        }\r\n\r\n        // Store user message for history navigation\r\n        this.userMessageHistory.push(message);\r\n        this.messageHistoryIndex = -1; // Reset navigation\r\n\r\n        // Add user message to history\r\n        this.addMessageToHistory('user', message);\r\n        this.messageInput.value = '';\r\n        this.autoResizeTextarea();\r\n\r\n        // Show typing indicator\r\n        const thinkingId = this.addMessageToHistory('assistant', '\uD83D\uDCAD Thinking...', true);\r\n\r\n        try {\r\n            // Prepare context for LLM\r\n            let context = `Current Note: ${this.currentNoteFile.basename}\\n\\nNote Content:\\n${this.currentNoteContent}`;\r\n            \r\n            console.log('Chat Panel Debug - Context Preparation:', {\r\n                noteContentLength: this.currentNoteContent.length,\r\n                pdfContentLength: this.currentPdfContent.length,\r\n                hasPdfContent: !!this.currentPdfContent\r\n            });\r\n            \r\n            if (this.currentPdfContent) {\r\n                const pdfContentToAdd = this.currentPdfContent.slice(0, 50000);\r\n                context += `\\n\\n--- Associated PDF Content ---\\n${pdfContentToAdd}`;\r\n                console.log('Chat Panel Debug - Added PDF to context:', {\r\n                    originalPdfLength: this.currentPdfContent.length,\r\n                    addedPdfLength: pdfContentToAdd.length,\r\n                    finalContextLength: context.length\r\n                });\r\n            }\r\n\r\n            // Create conversation history for context\r\n            const conversationHistory = this.chatHistory\r\n                .filter(msg => msg.role !== 'system')\r\n                .slice(-10) // Keep last 10 messages for context\r\n                .map(msg => `${msg.role}: ${msg.content}`)\r\n                .join('\\n');\r\n\r\n            const systemPrompt = `You are a helpful research assistant. You are chatting with a user about their current note and any associated PDF content. \r\n\r\nContext:\r\n${context}\r\n\r\nPrevious conversation:\r\n${conversationHistory}\r\n\r\nPlease provide helpful, accurate responses based on the note and PDF content. If the user asks about something not in the provided content, let them know that information isn't available in the current materials.`;\r\n\r\n            const response = await this.plugin.llmService.callLLMWithPrompt(systemPrompt, message);\r\n            \r\n            // Replace thinking message with actual response\r\n            this.updateMessageInHistory(thinkingId, response);\r\n            \r\n        } catch (error) {\r\n            console.error('Chat error:', error);\r\n            let errorMessage = 'An error occurred while processing your request.';\r\n            \r\n            if (error.message.includes('status 401')) {\r\n                errorMessage = '\u274C Authentication failed. Please check your API key in settings.\\n\\nTo fix this:\\n1. Go to Settings > Research Assistant\\n2. Verify your API key is correct\\n3. Make sure your OpenRouter account has credits\\n4. Try the \"Test LLM API\" command';\r\n            } else if (error.message.includes('status 403')) {\r\n                errorMessage = '\u274C Access forbidden. Your API key may not have permission for this model.';\r\n            } else if (error.message.includes('status 429')) {\r\n                errorMessage = '\u274C Rate limit exceeded. Please wait a moment and try again.';\r\n            } else if (error.message.includes('status 500')) {\r\n                errorMessage = '\u274C Server error. Please try again later.';\r\n            } else {\r\n                errorMessage = `\u274C Error: ${error.message}`;\r\n            }\r\n            \r\n            this.updateMessageInHistory(thinkingId, errorMessage);\r\n        }\r\n    }\r\n\r\n    addMessageToHistory(role, content, isTyping = false) {\r\n        const messageId = Date.now() + Math.random();\r\n        this.chatHistory.push({\r\n            id: messageId,\r\n            role,\r\n            content,\r\n            timestamp: new Date(),\r\n            isTyping: isTyping\r\n        });\r\n        this.renderChatHistory();\r\n        return messageId;\r\n    }\r\n\r\n    updateMessageInHistory(messageId, newContent) {\r\n        const message = this.chatHistory.find(msg => msg.id === messageId);\r\n        if (message) {\r\n            message.content = newContent;\r\n            message.isTyping = false; // Remove typing indicator\r\n            this.renderChatHistory();\r\n            this.saveConversation(); // Save when message is updated\r\n        }\r\n    }\r\n\r\n    deleteMessage(messageId) {\r\n        this.chatHistory = this.chatHistory.filter(msg => msg.id !== messageId);\r\n        this.renderChatHistory();\r\n        this.saveConversation();\r\n    }\r\n\r\n    async saveConversation() {\r\n        if (!this.currentNoteFile) return;\r\n        \r\n        // Save conversation to the conversations map\r\n        this.conversations.set(this.currentNoteFile.path, {\r\n            history: [...this.chatHistory],\r\n            userMessageHistory: [...this.userMessageHistory],\r\n            lastUpdated: new Date()\r\n        });\r\n\r\n        // Optionally persist to plugin settings (for session persistence)\r\n        if (this.plugin.settings) {\r\n            try {\r\n                const conversationsData = {};\r\n                for (const [path, conversation] of this.conversations.entries()) {\r\n                    // Only keep last 50 messages per conversation to avoid storage bloat\r\n                    conversationsData[path] = {\r\n                        ...conversation,\r\n                        history: conversation.history.slice(-50)\r\n                    };\r\n                }\r\n                this.plugin.settings.chatConversations = conversationsData;\r\n                await this.plugin.saveSettings();\r\n            } catch (error) {\r\n                console.warn('Failed to save chat conversations:', error);\r\n            }\r\n        }\r\n    }\r\n\r\n    async loadConversation() {\r\n        if (!this.currentNoteFile) return;\r\n\r\n        const filePath = this.currentNoteFile.path;\r\n        \r\n        // First check memory\r\n        if (this.conversations.has(filePath)) {\r\n            const conversation = this.conversations.get(filePath);\r\n            this.chatHistory = [...conversation.history];\r\n            this.userMessageHistory = [...conversation.userMessageHistory];\r\n            this.renderChatHistory();\r\n            return;\r\n        }\r\n\r\n        // Then check persisted settings\r\n        if (this.plugin.settings?.chatConversations?.[filePath]) {\r\n            const conversation = this.plugin.settings.chatConversations[filePath];\r\n            this.chatHistory = conversation.history || [];\r\n            this.userMessageHistory = conversation.userMessageHistory || [];\r\n            this.conversations.set(filePath, conversation);\r\n            this.renderChatHistory();\r\n            return;\r\n        }\r\n\r\n        // No existing conversation, start fresh\r\n        this.chatHistory = [];\r\n        this.userMessageHistory = [];\r\n        this.messageHistoryIndex = -1;\r\n        this.renderChatHistory();\r\n    }\r\n\r\n    renderChatHistory() {\r\n        if (!this.chatMessagesEl) return;\r\n\r\n        this.chatMessagesEl.empty();\r\n\r\n        this.chatHistory.forEach(message => {\r\n            const messageEl = this.chatMessagesEl.createEl('div', {\r\n                cls: `chat-message chat-message-${message.role}${message.isTyping ? ' typing' : ''}`\r\n            });\r\n\r\n            const headerEl = messageEl.createEl('div', { cls: 'chat-message-header' });\r\n            headerEl.createEl('span', {\r\n                cls: 'chat-message-role',\r\n                text: message.role === 'user' ? 'You' : 'Assistant'\r\n            });\r\n            \r\n            // Format timestamp\r\n            const timeStr = message.timestamp.toLocaleTimeString([], { \r\n                hour: '2-digit', \r\n                minute: '2-digit' \r\n            });\r\n            headerEl.createEl('span', {\r\n                cls: 'chat-message-time',\r\n                text: timeStr\r\n            });\r\n\r\n            const contentEl = messageEl.createEl('div', {\r\n                cls: 'chat-message-content'\r\n            });\r\n\r\n            // Handle markdown rendering for assistant messages\r\n            if (message.role === 'assistant' && !message.isTyping) {\r\n                // Basic markdown rendering\r\n                let content = message.content\r\n                    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n                    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\r\n                    .replace(/`(.*?)`/g, '<code>$1</code>')\r\n                    .replace(/\\n/g, '<br>');\r\n                contentEl.innerHTML = content;\r\n            } else {\r\n                contentEl.textContent = message.content;\r\n            }\r\n\r\n            // Add message actions\r\n            const actionsEl = messageEl.createEl('div', { cls: 'chat-message-actions' });\r\n            \r\n            // Copy button\r\n            const copyBtn = actionsEl.createEl('button', {\r\n                cls: 'chat-action-button',\r\n                title: 'Copy message'\r\n            });\r\n            copyBtn.innerHTML = '\uD83D\uDCCB';\r\n            copyBtn.addEventListener('click', () => {\r\n                navigator.clipboard.writeText(message.content);\r\n                // Show brief feedback\r\n                copyBtn.innerHTML = '\u2713';\r\n                setTimeout(() => copyBtn.innerHTML = '\uD83D\uDCCB', 1000);\r\n            });\r\n\r\n            // Delete button for user messages\r\n            if (message.role === 'user') {\r\n                const deleteBtn = actionsEl.createEl('button', {\r\n                    cls: 'chat-action-button chat-delete-button',\r\n                    title: 'Delete message'\r\n                });\r\n                deleteBtn.innerHTML = '\uD83D\uDDD1\uFE0F';\r\n                deleteBtn.addEventListener('click', () => {\r\n                    this.deleteMessage(message.id);\r\n                });\r\n            }\r\n        });\r\n\r\n        // Auto-scroll to bottom only if user isn't manually scrolling\r\n        if (!this.isUserScrolling) {\r\n            setTimeout(() => {\r\n                this.chatMessagesEl.scrollTop = this.chatMessagesEl.scrollHeight;\r\n            }, 10);\r\n        }\r\n    }\r\n\r\n    clearChat() {\r\n        this.chatHistory = [];\r\n        this.userMessageHistory = [];\r\n        this.messageHistoryIndex = -1;\r\n        this.renderChatHistory();\r\n        this.saveConversation(); // Save the cleared state\r\n    }\r\n\r\n    navigateMessageHistory(direction) {\r\n        if (this.userMessageHistory.length === 0) return;\r\n\r\n        this.messageHistoryIndex += direction;\r\n        \r\n        // Clamp the index\r\n        if (this.messageHistoryIndex < -1) {\r\n            this.messageHistoryIndex = -1;\r\n        } else if (this.messageHistoryIndex >= this.userMessageHistory.length) {\r\n            this.messageHistoryIndex = this.userMessageHistory.length - 1;\r\n        }\r\n\r\n        // Set the message input\r\n        if (this.messageHistoryIndex === -1) {\r\n            this.messageInput.value = '';\r\n        } else {\r\n            this.messageInput.value = this.userMessageHistory[this.userMessageHistory.length - 1 - this.messageHistoryIndex];\r\n        }\r\n        \r\n        this.autoResizeTextarea();\r\n    }\r\n\r\n    autoResizeTextarea() {\r\n        const textarea = this.messageInput;\r\n        textarea.style.height = 'auto';\r\n        const newHeight = Math.min(textarea.scrollHeight, 200); // Max 200px height\r\n        textarea.style.height = newHeight + 'px';\r\n    }\r\n\r\n    async testApiConnection() {\r\n        const testId = this.addMessageToHistory('system', 'Testing API connection...');\r\n        \r\n        try {\r\n            await this.plugin.llmService.testApi();\r\n            this.updateMessageInHistory(testId, '\u2705 API connection successful! Your API key and endpoint are working correctly.');\r\n        } catch (error) {\r\n            console.error('API test error:', error);\r\n            let errorMessage = '\u274C API test failed: ';\r\n            \r\n            if (error.message.includes('status 401')) {\r\n                errorMessage += 'Authentication failed. Your API key is invalid or expired.\\n\\nSteps to fix:\\n1. Check your OpenRouter dashboard\\n2. Verify your API key is active\\n3. Ensure your account has credits';\r\n            } else if (error.message.includes('status 403')) {\r\n                errorMessage += 'Access forbidden. Your API key may not have permission for the selected model.';\r\n            } else {\r\n                errorMessage += error.message;\r\n            }\r\n            \r\n            this.updateMessageInHistory(testId, errorMessage);\r\n        }\r\n    }\r\n\r\n    toggleSearch() {\r\n        // Simple search implementation\r\n        const searchTerm = prompt('Search conversation:');\r\n        if (!searchTerm) return;\r\n\r\n        const matches = this.chatHistory.filter(msg => \r\n            msg.content.toLowerCase().includes(searchTerm.toLowerCase())\r\n        );\r\n\r\n        if (matches.length === 0) {\r\n            this.addMessageToHistory('system', `No messages found containing \"${searchTerm}\"`);\r\n            return;\r\n        }\r\n\r\n        let resultText = `Found ${matches.length} message(s) containing \"${searchTerm}\":\\n\\n`;\r\n        matches.forEach((msg, index) => {\r\n            const time = msg.timestamp.toLocaleTimeString();\r\n            const preview = msg.content.length > 100 ? \r\n                msg.content.substring(0, 100) + '...' : \r\n                msg.content;\r\n            resultText += `${index + 1}. [${time}] ${msg.role}: ${preview}\\n\\n`;\r\n        });\r\n\r\n        this.addMessageToHistory('system', resultText);\r\n    }\r\n\r\n    async exportConversation() {\r\n        if (this.chatHistory.length === 0) {\r\n            this.addMessageToHistory('system', 'No conversation to export.');\r\n            return;\r\n        }\r\n\r\n        const exportData = {\r\n            paper: this.currentNoteFile?.basename || 'Unknown',\r\n            exportDate: new Date().toISOString(),\r\n            messageCount: this.chatHistory.length,\r\n            conversation: this.chatHistory.map(msg => ({\r\n                role: msg.role,\r\n                content: msg.content,\r\n                timestamp: msg.timestamp.toISOString()\r\n            }))\r\n        };\r\n\r\n        const exportText = `# Chat Export: ${exportData.paper}\r\nExported: ${new Date().toLocaleString()}\r\nMessages: ${exportData.messageCount}\r\n\r\n---\r\n\r\n${exportData.conversation.map(msg => \r\n`**${msg.role.charAt(0).toUpperCase() + msg.role.slice(1)}** (${new Date(msg.timestamp).toLocaleString()}):\r\n${msg.content}\r\n\r\n---`).join('\\n')}`;\r\n\r\n        try {\r\n            await navigator.clipboard.writeText(exportText);\r\n            this.addMessageToHistory('system', '\u2705 Conversation exported to clipboard!');\r\n        } catch (error) {\r\n            console.error('Export failed:', error);\r\n            this.addMessageToHistory('system', '\u274C Failed to export conversation. Check console for details.');\r\n        }\r\n    }\r\n\r\n    addStyles() {\r\n        const styleId = 'chat-panel-styles';\r\n        if (document.getElementById(styleId)) return;\r\n\r\n        const style = document.createElement('style');\r\n        style.id = styleId;\r\n        style.textContent = `\r\n            .chat-panel-container {\r\n                display: flex;\r\n                flex-direction: column;\r\n                height: 100%;\r\n                padding: 10px;\r\n            }\r\n\r\n            .chat-panel-header {\r\n                margin-bottom: 10px;\r\n                border-bottom: 1px solid var(--background-modifier-border);\r\n                padding-bottom: 10px;\r\n            }\r\n\r\n            .chat-panel-title {\r\n                margin: 0 0 10px 0;\r\n                font-size: 16px;\r\n                font-weight: 600;\r\n            }\r\n\r\n            .chat-note-info {\r\n                font-size: 12px;\r\n                color: var(--text-muted);\r\n            }\r\n\r\n            .chat-current-note .note-name {\r\n                font-weight: 500;\r\n                color: var(--text-normal);\r\n            }\r\n\r\n            .chat-current-note .note-status {\r\n                margin-top: 2px;\r\n            }\r\n\r\n            .chat-no-note {\r\n                text-align: center;\r\n                padding: 10px;\r\n                background: var(--background-secondary);\r\n                border-radius: 4px;\r\n            }\r\n\r\n            .no-note-message {\r\n                font-weight: 500;\r\n                margin-bottom: 4px;\r\n            }\r\n\r\n            .no-note-help {\r\n                font-size: 11px;\r\n                opacity: 0.7;\r\n            }\r\n\r\n            .chat-messages-area {\r\n                flex: 1;\r\n                overflow-y: auto;\r\n                margin-bottom: 10px;\r\n                border: 1px solid var(--background-modifier-border);\r\n                border-radius: 4px;\r\n                padding: 10px;\r\n                min-height: 200px;\r\n            }\r\n\r\n            .chat-message {\r\n                margin-bottom: 15px;\r\n                padding: 8px;\r\n                border-radius: 6px;\r\n                position: relative;\r\n                transition: all 0.2s ease;\r\n            }\r\n\r\n            .chat-message:hover {\r\n                transform: translateY(-1px);\r\n                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n            }\r\n\r\n            .chat-message.typing {\r\n                animation: typing-pulse 1.5s infinite;\r\n            }\r\n\r\n            @keyframes typing-pulse {\r\n                0%, 100% { opacity: 1; }\r\n                50% { opacity: 0.7; }\r\n            }\r\n\r\n            .chat-message-user {\r\n                background: var(--background-secondary);\r\n                margin-left: 20px;\r\n                border-left: 3px solid var(--interactive-accent);\r\n            }\r\n\r\n            .chat-message-assistant {\r\n                background: var(--background-primary-alt);\r\n                margin-right: 20px;\r\n                border-left: 3px solid var(--text-accent);\r\n            }\r\n\r\n            .chat-message-system {\r\n                background: var(--background-modifier-error);\r\n                text-align: center;\r\n                font-style: italic;\r\n                margin: 10px;\r\n            }\r\n\r\n            .chat-message-header {\r\n                display: flex;\r\n                justify-content: space-between;\r\n                margin-bottom: 5px;\r\n                font-size: 11px;\r\n                opacity: 0.7;\r\n            }\r\n\r\n            .chat-message-role {\r\n                font-weight: 500;\r\n            }\r\n\r\n            .chat-message-content {\r\n                white-space: pre-wrap;\r\n                line-height: 1.4;\r\n                margin-bottom: 5px;\r\n            }\r\n\r\n            .chat-message-content code {\r\n                background: var(--code-background);\r\n                padding: 2px 4px;\r\n                border-radius: 3px;\r\n                font-family: var(--font-monospace);\r\n                font-size: 0.9em;\r\n            }\r\n\r\n            .chat-message-content strong {\r\n                font-weight: 600;\r\n                color: var(--text-normal);\r\n            }\r\n\r\n            .chat-message-content em {\r\n                font-style: italic;\r\n                color: var(--text-muted);\r\n            }\r\n\r\n            .chat-message-actions {\r\n                display: flex;\r\n                gap: 4px;\r\n                margin-top: 5px;\r\n                opacity: 0;\r\n                transition: opacity 0.2s ease;\r\n            }\r\n\r\n            .chat-message:hover .chat-message-actions {\r\n                opacity: 1;\r\n            }\r\n\r\n            .chat-action-button {\r\n                background: none;\r\n                border: none;\r\n                cursor: pointer;\r\n                padding: 2px 4px;\r\n                border-radius: 3px;\r\n                font-size: 12px;\r\n                opacity: 0.7;\r\n                transition: all 0.2s ease;\r\n            }\r\n\r\n            .chat-action-button:hover {\r\n                opacity: 1;\r\n                background: var(--background-modifier-hover);\r\n            }\r\n\r\n            .chat-delete-button:hover {\r\n                background: var(--background-modifier-error);\r\n                color: var(--text-on-accent);\r\n            }\r\n\r\n            .chat-input-area {\r\n                border-top: 1px solid var(--background-modifier-border);\r\n                padding-top: 10px;\r\n            }\r\n\r\n            .chat-input-container {\r\n                display: flex;\r\n                gap: 8px;\r\n                margin-bottom: 8px;\r\n            }\r\n\r\n            .chat-message-input {\r\n                flex: 1;\r\n                resize: none;\r\n                min-height: 60px;\r\n                max-height: 200px;\r\n                padding: 8px;\r\n                border: 1px solid var(--background-modifier-border);\r\n                border-radius: 4px;\r\n                background: var(--background-primary);\r\n                color: var(--text-normal);\r\n                font-family: inherit;\r\n                line-height: 1.4;\r\n                transition: border-color 0.2s ease, box-shadow 0.2s ease;\r\n            }\r\n\r\n            .chat-message-input:focus {\r\n                outline: none;\r\n                border-color: var(--interactive-accent);\r\n                box-shadow: 0 0 0 2px rgba(var(--interactive-accent-rgb), 0.2);\r\n            }\r\n\r\n            .chat-send-button {\r\n                padding: 8px 16px;\r\n                background: var(--interactive-accent);\r\n                color: white;\r\n                border: none;\r\n                border-radius: 4px;\r\n                cursor: pointer;\r\n                font-weight: 500;\r\n            }\r\n\r\n            .chat-send-button:hover {\r\n                background: var(--interactive-accent-hover);\r\n            }\r\n\r\n            .chat-clear-button,\r\n            .chat-search-button,\r\n            .chat-export-button,\r\n            .chat-test-api-button {\r\n                padding: 4px 8px;\r\n                background: var(--interactive-normal);\r\n                color: var(--text-normal);\r\n                border: 1px solid var(--background-modifier-border);\r\n                border-radius: 4px;\r\n                cursor: pointer;\r\n                font-size: 11px;\r\n                margin-right: 8px;\r\n                transition: all 0.2s ease;\r\n            }\r\n\r\n            .chat-clear-button:hover,\r\n            .chat-search-button:hover,\r\n            .chat-export-button:hover,\r\n            .chat-test-api-button:hover {\r\n                background: var(--interactive-hover);\r\n                transform: translateY(-1px);\r\n            }\r\n\r\n            .chat-clear-button {\r\n                background: var(--background-secondary);\r\n                color: var(--text-muted);\r\n            }\r\n\r\n            .chat-search-button {\r\n                background: var(--interactive-accent);\r\n                color: white;\r\n            }\r\n\r\n            .chat-export-button {\r\n                background: var(--text-accent);\r\n                color: white;\r\n            }\r\n        `;\r\n        document.head.appendChild(style);\r\n    }\r\n\r\n    async onClose() {\r\n        // Clean up event listeners\r\n        this.chatHistory = [];\r\n    }\r\n}\r\n\r\nmodule.exports = { ChatPanelView, CHAT_PANEL_VIEW_TYPE };", "const { Modal, Notice } = require('obsidian');\r\n\r\nclass PaperModal extends Modal {\r\n    constructor(app, plugin, onSubmit) {\r\n        super(app);\r\n        this.plugin = plugin;\r\n        this.onSubmit = onSubmit;\r\n    }\r\n\r\n    async onOpen() {\r\n        const { contentEl } = this;\r\n        \r\n        this.createInstructions(contentEl);\r\n        const input = this.createUrlInput(contentEl);\r\n        const { sectorSelect, newSectorInput } = await this.createSectorSelection(contentEl);\r\n        const { button, spinner } = this.createSubmitButton(contentEl);\r\n        \r\n        this.setupSubmitHandler(button, spinner, input, sectorSelect, newSectorInput);\r\n    }\r\n\r\n    createInstructions(contentEl) {\r\n        contentEl.createEl('div', { \r\n            text: 'Enter the arXiv URL or a direct PDF link of the research paper:' \r\n        });\r\n    }\r\n\r\n    createUrlInput(contentEl) {\r\n        const input = contentEl.createEl('input', { \r\n            type: 'text', \r\n            placeholder: 'https://arxiv.org/abs/...  OR  https://domain.com/paper.pdf' \r\n        });\r\n        input.style.width = '100%';\r\n        input.style.marginTop = '10px';\r\n        return input;\r\n    }\r\n\r\n    async createSectorSelection(contentEl) {\r\n        contentEl.createEl('div', { text: 'Select research sector:' });\r\n        \r\n        const sectorSelect = contentEl.createEl('select');\r\n        sectorSelect.style.width = '100%';\r\n        sectorSelect.style.marginTop = '6px';\r\n\r\n        const sectors = await this.plugin.paperService.getAvailableSectors();\r\n        for (const s of sectors) {\r\n            sectorSelect.createEl('option', { text: s, value: s });\r\n        }\r\n        sectorSelect.value = this.plugin.settings.defaultSector || 'Other';\r\n\r\n        const newSectorInput = contentEl.createEl('input', { \r\n            type: 'text', \r\n            placeholder: 'Or type a new sector name' \r\n        });\r\n        newSectorInput.style.width = '100%';\r\n        newSectorInput.style.marginTop = '6px';\r\n\r\n        return { sectorSelect, newSectorInput };\r\n    }\r\n\r\n    createSubmitButton(contentEl) {\r\n        const buttonContainer = contentEl.createEl('div', { cls: 'button-container' });\r\n        buttonContainer.style.display = 'flex';\r\n        buttonContainer.style.justifyContent = 'center';\r\n        \r\n        const button = buttonContainer.createEl('button', { text: 'Add Paper' });\r\n        button.style.marginTop = '20px';\r\n\r\n        this.addSpinnerStyles();\r\n        \r\n        const spinner = buttonContainer.createEl('div', { cls: 'ra-spinner' });\r\n        spinner.style.display = 'none';\r\n        spinner.style.border = '4px solid rgba(0,0,0,0.1)';\r\n        spinner.style.borderTop = '4px solid var(--interactive-accent)';\r\n        spinner.style.borderRadius = '50%';\r\n        spinner.style.width = '18px';\r\n        spinner.style.height = '18px';\r\n        spinner.style.marginLeft = '8px';\r\n        spinner.style.animation = 'ra-spin 1s linear infinite';\r\n\r\n        return { button, spinner };\r\n    }\r\n\r\n    addSpinnerStyles() {\r\n        if (!document.getElementById('ra-spinner-style')) {\r\n            const style = document.createElement('style');\r\n            style.id = 'ra-spinner-style';\r\n            style.textContent = `@keyframes ra-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }`;\r\n            document.head.appendChild(style);\r\n        }\r\n    }\r\n\r\n    setupSubmitHandler(button, spinner, input, sectorSelect, newSectorInput) {\r\n        button.addEventListener('click', async () => {\r\n            const url = input.value.trim();\r\n            if (!url) return;\r\n            \r\n            let sector = sectorSelect.value;\r\n            const newSector = newSectorInput.value.trim();\r\n            \r\n            if (newSector) {\r\n                sector = newSector;\r\n                if (!this.plugin.settings.sectors.includes(newSector)) {\r\n                    this.plugin.settings.sectors.push(newSector);\r\n                    await this.plugin.saveSettings();\r\n                }\r\n            }\r\n            \r\n            await this.handleSubmission(button, spinner, input, sectorSelect, newSectorInput, url, sector);\r\n        });\r\n    }\r\n\r\n    async handleSubmission(button, spinner, input, sectorSelect, newSectorInput, url, sector) {\r\n        const originalBtnText = button.textContent;\r\n        \r\n        try {\r\n            this.setLoadingState(true, button, spinner, input, sectorSelect, newSectorInput);\r\n            await this.onSubmit(url, sector);\r\n            this.close();\r\n        } catch (err) {\r\n            new Notice('Error adding paper: ' + (err && err.message ? err.message : String(err)));\r\n        } finally {\r\n            this.setLoadingState(false, button, spinner, input, sectorSelect, newSectorInput, originalBtnText);\r\n        }\r\n    }\r\n\r\n    setLoadingState(loading, button, spinner, input, sectorSelect, newSectorInput, originalText = 'Add Paper') {\r\n        button.disabled = loading;\r\n        input.disabled = loading;\r\n        sectorSelect.disabled = loading;\r\n        newSectorInput.disabled = loading;\r\n        spinner.style.display = loading ? 'inline-block' : 'none';\r\n        button.textContent = loading ? 'Adding...' : originalText;\r\n    }\r\n\r\n    onClose() {\r\n        this.contentEl.empty();\r\n    }\r\n}\r\n\r\nmodule.exports = PaperModal;", "const { PluginSettingTab, Setting } = require('obsidian');\r\n\r\nclass RASettingTab extends PluginSettingTab {\r\n    constructor(app, plugin) {\r\n        super(app, plugin);\r\n        this.plugin = plugin;\r\n    }\r\n\r\n    async display() {\r\n        const { containerEl } = this;\r\n        containerEl.empty();\r\n        containerEl.createEl('h2', { text: 'Research Assistant Settings' });\r\n\r\n        this.createFolderSettings(containerEl);\r\n        this.createApiSettings(containerEl);\r\n        await this.createSectorSettings(containerEl);\r\n    }\r\n\r\n    createFolderSettings(containerEl) {\r\n        new Setting(containerEl)\r\n            .setName('PDF Download Folder')\r\n            .setDesc('The folder to save papers and notes.')\r\n            .addText(text => text\r\n                .setPlaceholder('e.g., _research-papers')\r\n                .setValue(this.plugin.settings.pdfDownloadFolder)\r\n                .onChange(async (value) => {\r\n                    this.plugin.settings.pdfDownloadFolder = value || '_research-papers';\r\n                    await this.plugin.saveSettings();\r\n                    await this.plugin.rebuildAndRefresh();\r\n                }));\r\n        \r\n        new Setting(containerEl)\r\n            .setName('Hide folder from Files')\r\n            .setDesc('Prefix the folder name with a dot (e.g., \".research-papers\") to hide it. This will move the existing folder and its contents.')\r\n            .addToggle(toggle => toggle\r\n                .setValue(this.plugin.settings.hideFolderFromFiles)\r\n                .onChange(async (value) => {\r\n                    await this.plugin.fileService.toggleFolderVisibility(\r\n                        value, \r\n                        () => this.plugin.saveSettings(),\r\n                        () => this.plugin.rebuildAndRefresh()\r\n                    );\r\n                }));\r\n    }\r\n\r\n    createApiSettings(containerEl) {\r\n        containerEl.createEl('h3', { text: 'Summarization API Settings' });\r\n\r\n        new Setting(containerEl)\r\n            .setName('API Endpoint URL')\r\n            .addText(text => text\r\n                .setPlaceholder('https://api.openai.com/v1/chat/completions')\r\n                .setValue(this.plugin.settings.summaryApiEndpoint)\r\n                .onChange(async (value) => {\r\n                    this.plugin.settings.summaryApiEndpoint = value;\r\n                    await this.plugin.saveSettings();\r\n                }));\r\n                \r\n        new Setting(containerEl)\r\n            .setName('Model Name')\r\n            .addText(text => text\r\n                .setPlaceholder('gpt-4-turbo')\r\n                .setValue(this.plugin.settings.summaryApiModel)\r\n                .onChange(async (value) => {\r\n                    this.plugin.settings.summaryApiModel = value;\r\n                    await this.plugin.saveSettings();\r\n                }));\r\n                \r\n        new Setting(containerEl)\r\n            .setName('API Key')\r\n            .addText(text => text\r\n                .setPlaceholder('sk-xxxxxxxxxxxx')\r\n                .setValue(this.plugin.settings.summaryApiKey)\r\n                .onChange(async (value) => {\r\n                    this.plugin.settings.summaryApiKey = value;\r\n                    await this.plugin.saveSettings();\r\n                }));\r\n    }\r\n\r\n    async createSectorSettings(containerEl) {\r\n        containerEl.createEl('h3', { text: 'Research Sectors' });\r\n        \r\n        const availableSectors = await this.plugin.paperService.getAvailableSectors();\r\n\r\n        // Ensure the configured defaultSector is valid\r\n        if (!availableSectors.includes(this.plugin.settings.defaultSector)) {\r\n            const fallback = availableSectors.includes('Other') ? 'Other' : (availableSectors[0] || 'Other');\r\n            this.plugin.settings.defaultSector = fallback;\r\n            await this.plugin.saveSettings();\r\n        }\r\n\r\n        new Setting(containerEl)\r\n            .setName('Default Sector')\r\n            .setDesc('Sector selected by default when adding new papers.')\r\n            .addDropdown(drop => {\r\n                drop.addOptions(Object.fromEntries(availableSectors.map(s => [s, s])));\r\n                try { \r\n                    drop.setValue(this.plugin.settings.defaultSector); \r\n                } catch (e) { \r\n                    drop.setValue(availableSectors[0] || 'Other'); \r\n                }\r\n                drop.onChange(async (value) => {\r\n                    this.plugin.settings.defaultSector = value;\r\n                    await this.plugin.saveSettings();\r\n                });\r\n            });\r\n\r\n        this.createSectorManagement(containerEl, availableSectors);\r\n    }\r\n\r\n    createSectorManagement(containerEl, availableSectors) {\r\n        new Setting(containerEl)\r\n            .setName('Manage Sectors')\r\n            .setDesc('Add or remove sectors. Folders found on disk are automatically included.');\r\n\r\n        const sectorsWrap = containerEl.createEl('div', { cls: 'sectors-wrap' });\r\n        \r\n        availableSectors.forEach(sector => {\r\n            const isManaged = this.plugin.settings.sectors.includes(sector);\r\n            const isDiscovered = !isManaged;\r\n\r\n            const setting = new Setting(sectorsWrap).setName(sector);\r\n            \r\n            if (isDiscovered) {\r\n                setting.setDesc(\"Discovered from folder\");\r\n            }\r\n\r\n            if (isManaged && sector !== 'Other') { // Prevent removing 'Other'\r\n                setting.addButton(button => {\r\n                    button.setButtonText('Remove').onClick(async () => {\r\n                        this.plugin.settings.sectors = this.plugin.settings.sectors.filter(s => s !== sector);\r\n                        if (this.plugin.settings.defaultSector === sector) {\r\n                            this.plugin.settings.defaultSector = 'Other';\r\n                        }\r\n                        await this.plugin.saveSettings();\r\n                        this.display();\r\n                    });\r\n                });\r\n            }\r\n        });\r\n\r\n        this.createNewSectorInput(containerEl);\r\n    }\r\n\r\n    createNewSectorInput(containerEl) {\r\n        new Setting(containerEl)\r\n            .setName('Add new sector')\r\n            .addText(text => {\r\n                text.setPlaceholder('New sector name');\r\n                text.inputEl.addEventListener('keydown', async (e) => {\r\n                    if (e.key === 'Enter') {\r\n                        e.preventDefault();\r\n                        const value = text.getValue().trim();\r\n                        if (value && !this.plugin.settings.sectors.includes(value)) {\r\n                            this.plugin.settings.sectors.push(value);\r\n                            // Automatically create the folder for the new sector\r\n                            await this.plugin.fileService.ensureFolderExists(`${this.plugin.settings.pdfDownloadFolder}/${value}`);\r\n                            await this.plugin.saveSettings();\r\n                            text.setValue('');\r\n                            this.display();\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n    }\r\n}\r\n\r\nmodule.exports = RASettingTab;", "const { Plugin, Notice, TFile } = require('obsidian');\r\n\r\n// Import all our modular components\r\nconst { DEFAULT_SETTINGS } = require('./config/constants');\r\nconst LLMService = require('./services/llm-service');\r\nconst MetadataService = require('./services/metadata-service');\r\nconst FileService = require('./services/file-service');\r\nconst PaperService = require('./services/paper-service');\r\nconst PdfService = require('./services/pdf-service');\r\nconst { PaperExplorerView, PAPER_EXPLORER_VIEW_TYPE } = require('./ui/paper-explorer-view');\r\nconst { ChatPanelView, CHAT_PANEL_VIEW_TYPE } = require('./ui/chat-panel-view');\r\nconst PaperModal = require('./ui/paper-modal');\r\nconst RASettingTab = require('./ui/settings-tab');\r\nconst { generatePdfFileName } = require('./utils/formatters');\r\n\r\n/**\r\n * Main plugin class for the Research Assistant\r\n */\r\nclass ResearchAssistantPlugin extends Plugin {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._activeSector = 'All';\r\n    }\r\n\r\n    async onload() {\r\n        await this.loadSettings();\r\n        this.initializeServices();\r\n        this.setupEventHandlers();\r\n        this.registerViews();\r\n        this.registerCommands();\r\n        this.addSettingTab(new RASettingTab(this.app, this));\r\n        \r\n        console.log('Research Assistant plugin loaded.');\r\n    }\r\n\r\n    /**\r\n     * Initialize all service instances\r\n     */\r\n    initializeServices() {\r\n        this.llmService = new LLMService(this.settings);\r\n        this.metadataService = new MetadataService();\r\n        this.fileService = new FileService(this.app, this.settings);\r\n        this.pdfService = new PdfService(this.app, this.settings);\r\n        this.paperService = new PaperService(this.app, this.settings, this.fileService, this.pdfService);\r\n    }\r\n\r\n    /**\r\n     * Set up event handlers for file system changes\r\n     */\r\n    setupEventHandlers() {\r\n        this.app.workspace.onLayoutReady(async () => {\r\n            await this.paperService.buildPaperIndex();\r\n            this.registerEvent(this.app.vault.on('create', this.handleFileCreate.bind(this)));\r\n            this.registerEvent(this.app.vault.on('delete', this.handleFileDelete.bind(this)));\r\n            this.registerEvent(this.app.vault.on('rename', this.handleFileRename.bind(this)));\r\n            this.registerEvent(this.app.metadataCache.on('changed', this.handleMetadataChange.bind(this)));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Register views and ribbon icons\r\n     */\r\n    registerViews() {\r\n        this.registerView(\r\n            PAPER_EXPLORER_VIEW_TYPE,\r\n            (leaf) => new PaperExplorerView(leaf, this.settings, this)\r\n        );\r\n\r\n        this.registerView(\r\n            CHAT_PANEL_VIEW_TYPE,\r\n            (leaf) => new ChatPanelView(leaf, this.settings, this)\r\n        );\r\n\r\n        this.addRibbonIcon('library', 'Open Paper Explorer', () => {\r\n            this.openMasterIndexInMainView().then(() => this.activateView());\r\n        });\r\n\r\n        this.addRibbonIcon('message-circle', 'Open Note Chat', () => {\r\n            this.activateChatView();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Register plugin commands\r\n     */\r\n    registerCommands() {\r\n        this.addCommand({\r\n            id: 'add-research-paper',\r\n            name: 'Add Research Paper',\r\n            callback: () => this.openAddPaperModal()\r\n        });\r\n        \r\n        this.addCommand({\r\n            id: 'open-paper-explorer',\r\n            name: 'Open Paper Explorer',\r\n            callback: () => {\r\n                this.openMasterIndexInMainView().then(() => this.activateView());\r\n            }\r\n        });\r\n\r\n        this.addCommand({\r\n            id: 'generate-resume-all-papers',\r\n            name: 'Generate Resume for All Papers',\r\n            callback: () => this.paperService.generateResumeForPapers(this.llmService)\r\n        });\r\n\r\n        this.addCommand({\r\n            id: 'generate-tags-all-papers',\r\n            name: 'Generate Tags for All Papers',\r\n            callback: () => this.paperService.generateTagsForPapers(this.llmService)\r\n        });\r\n\r\n        this.addCommand({\r\n            id: 'clean-resume-sections',\r\n            name: 'Clean Resume Sections from All Papers',\r\n            callback: async () => {\r\n                try {\r\n                    await this.paperService.buildPaperIndex();\r\n                    await this.paperService.cleanAllResumes();\r\n                    await this.rebuildAndRefresh();\r\n                } catch (err) {\r\n                    console.error('Error cleaning resume sections:', err);\r\n                    new Notice('Failed to clean resume sections: ' + (err && err.message ? err.message : String(err)));\r\n                }\r\n            }\r\n        });\r\n\r\n        this.addCommand({\r\n            id: 'test-llm-api',\r\n            name: 'Test LLM API Configuration',\r\n            callback: () => this.testLLMApi()\r\n        });\r\n        \r\n        this.addCommand({\r\n            id: 'rebuild-paper-index',\r\n            name: 'Rebuild Paper Index',\r\n            callback: async () => {\r\n                new Notice('Rebuilding paper index...');\r\n                await this.rebuildAndRefresh();\r\n                new Notice('Paper index rebuilt.');\r\n            }\r\n        });\r\n\r\n        this.addCommand({\r\n            id: 'generate-resume-current-note',\r\n            name: 'Generate Resume for Current Note',\r\n            callback: () => this.generateResumeForCurrentNote()\r\n        });\r\n\r\n        this.addCommand({\r\n            id: 'open-note-chat',\r\n            name: 'Open Note Chat Panel',\r\n            callback: () => this.activateChatView()\r\n        });\r\n    }\r\n\r\n    // ======================================================\r\n    // FILE EVENT HANDLERS\r\n    // ======================================================\r\n\r\n    async handleFileCreate(file) {\r\n        if (file instanceof TFile && this.paperService.isPaperFile(file)) {\r\n            const paperData = await this.paperService.parsePaperFile(file);\r\n            if (paperData) {\r\n                this.paperService.paperIndex.set(file.path, paperData);\r\n                this.paperService.scheduleRebuild(300, () => this.rebuildAndRefresh());\r\n            }\r\n        }\r\n    }\r\n\r\n    async handleFileDelete(file) {\r\n        if (this.paperService.paperIndex.has(file.path)) {\r\n            this.paperService.paperIndex.delete(file.path);\r\n            this.paperService.scheduleRebuild(300, () => this.rebuildAndRefresh());\r\n        }\r\n    }\r\n\r\n    async handleFileRename(file, oldPath) {\r\n        if (this.paperService.paperIndex.has(oldPath)) {\r\n            this.paperService.paperIndex.delete(oldPath);\r\n        }\r\n        if (file instanceof TFile && this.paperService.isPaperFile(file)) {\r\n            const paperData = await this.paperService.parsePaperFile(file);\r\n            if (paperData) {\r\n                this.paperService.paperIndex.set(file.path, paperData);\r\n            }\r\n        }\r\n        this.paperService.scheduleRebuild(300, () => this.rebuildAndRefresh());\r\n    }\r\n\r\n    async handleMetadataChange(file) {\r\n        if (this.paperService.paperIndex.has(file.path)) {\r\n            const paperData = await this.paperService.parsePaperFile(file);\r\n            if (paperData) {\r\n                this.paperService.paperIndex.set(file.path, paperData);\r\n                this.paperService.scheduleRebuild(300, () => this.rebuildAndRefresh());\r\n            }\r\n        }\r\n    }\r\n\r\n    // ======================================================\r\n    // MAIN OPERATIONS\r\n    // ======================================================\r\n\r\n    /**\r\n     * Process new paper from URL\r\n     * @param {string} url - Paper URL\r\n     * @param {string} sector - Research sector\r\n     */\r\n    async processNewPaper(url, sector) {\r\n        try {\r\n            new Notice('Fetching paper data...');\r\n            \r\n            const metadata = await this.metadataService.getMetadataFromUrl(url);\r\n            const useSector = sector || this.settings.defaultSector || 'Other';\r\n            const pdfFileName = generatePdfFileName(metadata);\r\n            \r\n            const pdfLogicalPath = await this.fileService.downloadPdf(metadata, useSector, pdfFileName);\r\n            await this.fileService.createPaperNote(metadata, useSector, pdfLogicalPath);\r\n            \r\n            new Notice(`Successfully added '${metadata.title}'!`);\r\n            this.activateView();\r\n            this.paperService.scheduleRebuild(150, () => this.rebuildAndRefresh());\r\n        } catch (error) {\r\n            console.error(error);\r\n            new Notice(`Error: ${error.message}`, 10000);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Delete paper and refresh index\r\n     * @param {TFile} noteFile - Note file to delete\r\n     */\r\n    async deletePaper(noteFile) {\r\n        const paperData = this.paperService.paperIndex.get(noteFile.path);\r\n        await this.fileService.deletePaper(noteFile, paperData);\r\n        this.paperService.scheduleRebuild(150, () => this.rebuildAndRefresh());\r\n    }\r\n\r\n    /**\r\n     * Test LLM API configuration\r\n     */\r\n    async testLLMApi() {\r\n        try {\r\n            new Notice('Testing LLM API configuration...');\r\n            await this.llmService.testApi();\r\n            new Notice('\u2705 LLM API test successful!');\r\n        } catch (error) {\r\n            new Notice(`\u274C LLM API test failed: ${error.message}`);\r\n            console.error('LLM API test error:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generate resume for currently active note\r\n     */\r\n    async generateResumeForCurrentNote() {\r\n        try {\r\n            const activeFile = this.app.workspace.getActiveFile();\r\n            if (!activeFile || activeFile.extension !== 'md') {\r\n                new Notice('No active markdown file found.');\r\n                return;\r\n            }\r\n\r\n            new Notice('Generating resume for current note...');\r\n\r\n            // Read the current note content\r\n            const noteContent = await this.app.vault.read(activeFile);\r\n            let contentToSummarize = noteContent;\r\n\r\n            // Check if there's an associated PDF file\r\n            const paperData = this.paperService.paperIndex.get(activeFile.path);\r\n            if (paperData && paperData.frontmatter && paperData.frontmatter.pdf_link) {\r\n                try {\r\n                    // Try to find and read the PDF file\r\n                    const pdfFile = this.app.vault.getAbstractFileByPath(paperData.frontmatter.pdf_link);\r\n                    if (pdfFile instanceof TFile && pdfFile.extension === 'pdf') {\r\n                        new Notice('Found associated PDF, extracting text...');\r\n                        const pdfText = await this.pdfService.extractTextFromPdf(pdfFile);\r\n                        contentToSummarize = `Note Content:\\n${noteContent}\\n\\n--- Associated PDF Content ---\\n${pdfText}`;\r\n                    }\r\n                } catch (pdfError) {\r\n                    console.warn('Could not extract PDF content:', pdfError);\r\n                    new Notice('Using note content only (PDF extraction failed)');\r\n                }\r\n            }\r\n\r\n            // Generate the resume using LLM service\r\n            const resume = await this.llmService.getSummary(contentToSummarize);\r\n\r\n            // Insert the resume into the note\r\n            await this.insertResumeIntoNote(activeFile, resume);\r\n\r\n            new Notice(`\u2705 Resume generated for '${activeFile.basename}'!`);\r\n        } catch (error) {\r\n            console.error('Error generating resume for current note:', error);\r\n            new Notice(`\u274C Failed to generate resume: ${error.message}`, 8000);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Insert resume into note, replacing existing resume if present\r\n     * @param {TFile} noteFile - The note file\r\n     * @param {string} resume - The generated resume\r\n     */\r\n    async insertResumeIntoNote(noteFile, resume) {\r\n        const content = await this.app.vault.read(noteFile);\r\n        \r\n        // Check if there's already a resume section\r\n        const resumeStartRegex = /^## Resume$/m;\r\n        const resumeEndRegex = /^## /m;\r\n        \r\n        const startMatch = content.match(resumeStartRegex);\r\n        if (startMatch) {\r\n            // Find the end of the resume section\r\n            const startIndex = startMatch.index + startMatch[0].length;\r\n            const remainingContent = content.slice(startIndex);\r\n            const endMatch = remainingContent.match(resumeEndRegex);\r\n            \r\n            let newContent;\r\n            if (endMatch) {\r\n                // Replace existing resume section\r\n                const endIndex = startIndex + endMatch.index;\r\n                newContent = content.slice(0, startMatch.index) + \r\n                           `## Resume\\n\\n${resume}\\n\\n` + \r\n                           content.slice(endIndex);\r\n            } else {\r\n                // Resume section goes to end of file\r\n                newContent = content.slice(0, startMatch.index) + \r\n                           `## Resume\\n\\n${resume}\\n`;\r\n            }\r\n            \r\n            await this.app.vault.modify(noteFile, newContent);\r\n        } else {\r\n            // No existing resume section, add at the end\r\n            const newContent = content + `\\n\\n## Resume\\n\\n${resume}\\n`;\r\n            await this.app.vault.modify(noteFile, newContent);\r\n        }\r\n    }\r\n\r\n    // ======================================================\r\n    // UI OPERATIONS\r\n    // ======================================================\r\n\r\n    /**\r\n     * Open the add paper modal\r\n     */\r\n    openAddPaperModal() {\r\n        new PaperModal(this.app, this, async (url, sector) => {\r\n            return await this.processNewPaper(url, sector);\r\n        }).open();\r\n    }\r\n\r\n    /**\r\n     * Activate the paper explorer view\r\n     */\r\n    async activateView() {\r\n        const { workspace } = this.app;\r\n        let leaf = workspace.getLeavesOfType(PAPER_EXPLORER_VIEW_TYPE)[0];\r\n\r\n        if (!leaf) {\r\n            leaf = workspace.getLeftLeaf(false);\r\n            await leaf.setViewState({\r\n                type: PAPER_EXPLORER_VIEW_TYPE,\r\n                active: true,\r\n            });\r\n        }\r\n        workspace.revealLeaf(leaf);\r\n    }\r\n\r\n    /**\r\n     * Activate the chat panel view\r\n     */\r\n    async activateChatView() {\r\n        const { workspace } = this.app;\r\n        let leaf = workspace.getLeavesOfType(CHAT_PANEL_VIEW_TYPE)[0];\r\n\r\n        if (!leaf) {\r\n            leaf = workspace.getRightLeaf(false);\r\n            await leaf.setViewState({\r\n                type: CHAT_PANEL_VIEW_TYPE,\r\n                active: true,\r\n            });\r\n        }\r\n        workspace.revealLeaf(leaf);\r\n    }\r\n\r\n    /**\r\n     * Refresh paper explorer view\r\n     */\r\n    refreshPaperExplorerView() {\r\n        const leaves = this.app.workspace.getLeavesOfType(PAPER_EXPLORER_VIEW_TYPE);\r\n        leaves.forEach(leaf => {\r\n            if (leaf.view instanceof PaperExplorerView) {\r\n                leaf.view.renderView();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Open master index in main view\r\n     */\r\n    async openMasterIndexInMainView() {\r\n        const indexPath = `_papers_index.md`;\r\n        await this.fileService.ensureFolderExists(this.settings.pdfDownloadFolder);\r\n        \r\n        if (!await this.app.vault.adapter.exists(indexPath)) {\r\n            await this.paperService.updateMasterIndex();\r\n        }\r\n        \r\n        const file = this.app.vault.getAbstractFileByPath(indexPath);\r\n        if (file instanceof TFile) {\r\n            const leaf = this.app.workspace.getLeaf(false);\r\n            await leaf.openFile(file);\r\n        }\r\n    }\r\n\r\n    // ======================================================\r\n    // INDEX MANAGEMENT\r\n    // ======================================================\r\n\r\n    /**\r\n     * Complete rebuild and refresh pipeline\r\n     */\r\n    async rebuildAndRefresh() {\r\n        await this.paperService.buildPaperIndex();\r\n        await this.fileService.cleanEmptySectorFolders();\r\n        await this.paperService.pruneUnusedSectors(() => this.saveSettings());\r\n        await this.refreshAllArtifacts();\r\n    }\r\n\r\n    /**\r\n     * Refresh all UI artifacts\r\n     */\r\n    async refreshAllArtifacts() {\r\n        this.refreshPaperExplorerView();\r\n        await this.paperService.updateMasterIndex();\r\n    }\r\n\r\n    // ======================================================\r\n    // SETTINGS\r\n    // ======================================================\r\n\r\n    async loadSettings() {\r\n        this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());\r\n    }\r\n\r\n    async saveSettings() {\r\n        await this.saveData(this.settings);\r\n        // Update services when settings change\r\n        if (this.llmService) {\r\n            this.llmService.settings = this.settings;\r\n        }\r\n        if (this.fileService) {\r\n            this.fileService.settings = this.settings;\r\n        }\r\n        if (this.paperService) {\r\n            this.paperService.settings = this.settings;\r\n        }\r\n    }\r\n\r\n    onunload() {\r\n        if (this.paperService) {\r\n            this.paperService.paperIndex.clear();\r\n        }\r\n        console.log('Research Assistant plugin unloaded.');\r\n    }\r\n}\r\n\r\nmodule.exports = ResearchAssistantPlugin;"],
  "mappings": "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",
  "names": ["exports", "module", "DEFAULT_SETTINGS", "exports", "module", "LLMService", "exports", "module", "MetadataService", "exports", "module", "generatePdfFileName", "exports", "module", "TFile", "Notice", "generatePdfFileName", "FileService", "exports", "module", "TFile", "Notice", "PaperService", "exports", "module", "Notice", "PdfService", "exports", "module", "TFile", "PAPER_EXPLORER_VIEW_TYPE", "PaperExplorerView", "exports", "module", "TFile", "CHAT_PANEL_VIEW_TYPE", "ChatPanelView", "exports", "module", "Notice", "PaperModal", "exports", "module", "RASettingTab", "Notice"]
}
